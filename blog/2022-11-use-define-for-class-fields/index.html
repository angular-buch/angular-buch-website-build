<!DOCTYPE html><html lang="de" data-critters-container=""><head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#"><meta name="generator" content="Scully 0.0.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <title>Angular-Buch → TypeScript: useDefineForClassFields – zukünftige Breaking Changes vermeiden</title>
  

  

  <meta property="book:author" content="https://www.facebook.com/ferdinand.malcher">
  <meta property="book:author" content="https://www.facebook.com/johannes.hoppe">

  <meta property="book:isbn" content="9783864909467">
  <meta property="book:release_date" content="2023-02-28">
  <meta property="book:tag" content="Angular">
  <meta property="book:tag" content="Webentwicklung">
  <meta property="book:tag" content="AngularJS">
  <meta property="book:tag" content="TypeScript">
  <meta property="book:tag" content="JavaScript">
  <meta property="book:tag" content="HTML5">
  <meta property="book:tag" content="CSS">
  <meta property="book:tag" content="RxJS">
  <meta property="book:tag" content="Redux">
  <meta property="book:tag" content="NgRx">

  <base href="/">
<style>@charset "UTF-8";@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@font-face{font-family:Roboto;src:url(./media/Roboto-Thin-GAS35NAQ.eot);src:local("Roboto Thin"),local("Roboto-Thin"),url(./media/Roboto-Thin-GAS35NAQ.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Thin-UUU7IP4L.woff2) format("woff2"),url(./media/Roboto-Thin-BT5WDCMC.woff) format("woff"),url(./media/Roboto-Thin-STLHGJGZ.ttf) format("truetype"),url(./media/Roboto-Thin-OYOYLS5N.svg#Roboto) format("svg");font-weight:100;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-ThinItalic-HQCJJ3KQ.eot);src:local("Roboto ThinItalic"),local("Roboto-ThinItalic"),url(./media/Roboto-ThinItalic-HQCJJ3KQ.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-ThinItalic-PVCCLVHZ.woff2) format("woff2"),url(./media/Roboto-ThinItalic-OJCFQICS.woff) format("woff"),url(./media/Roboto-ThinItalic-OKVQEY6M.ttf) format("truetype"),url(./media/Roboto-ThinItalic-PU7U6F54.svg#Roboto) format("svg");font-weight:100;font-style:italic}@font-face{font-family:Roboto;src:url(./media/Roboto-Light-TT7V6J7W.eot);src:local("Roboto Light"),local("Roboto-Light"),url(./media/Roboto-Light-TT7V6J7W.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Light-OEL5QP53.woff2) format("woff2"),url(./media/Roboto-Light-EGEOUPZ7.woff) format("woff"),url(./media/Roboto-Light-KYCYMX5R.ttf) format("truetype"),url(./media/Roboto-Light-O5NB3DZS.svg#Roboto) format("svg");font-weight:300;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-LightItalic-JJ225GLJ.eot);src:local("Roboto LightItalic"),local("Roboto-LightItalic"),url(./media/Roboto-LightItalic-JJ225GLJ.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-LightItalic-SZU3UOEY.woff2) format("woff2"),url(./media/Roboto-LightItalic-5LJGTDBY.woff) format("woff"),url(./media/Roboto-LightItalic-ZTOFFLND.ttf) format("truetype"),url(./media/Roboto-LightItalic-FE5GYQJO.svg#Roboto) format("svg");font-weight:300;font-style:italic}@font-face{font-family:Roboto;src:url(./media/Roboto-Regular-WINA5356.eot);src:local("Roboto Regular"),local("Roboto-Regular"),url(./media/Roboto-Regular-WINA5356.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Regular-4ZFX4XNS.woff2) format("woff2"),url(./media/Roboto-Regular-EMJ7NDAQ.woff) format("woff"),url(./media/Roboto-Regular-W6LM4ZNI.ttf) format("truetype"),url(./media/Roboto-Regular-DDBAS5OS.svg#Roboto) format("svg");font-weight:400;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-RegularItalic-43QNLNAN.eot);src:local("Roboto RegularItalic"),local("Roboto-RegularItalic"),url(./media/Roboto-RegularItalic-43QNLNAN.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-RegularItalic-2REFJECD.woff2) format("woff2"),url(./media/Roboto-RegularItalic-NSJ4HBKT.woff) format("woff"),url(./media/Roboto-RegularItalic-YZDJVEXU.ttf) format("truetype"),url(./media/Roboto-RegularItalic-7A3VJZ2J.svg#Roboto) format("svg");font-weight:400;font-style:italic}@font-face{font-family:Roboto;src:url(./media/Roboto-Medium-TKOJIIN4.eot);src:local("Roboto Medium"),local("Roboto-Medium"),url(./media/Roboto-Medium-TKOJIIN4.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Medium-GHCC3HN6.woff2) format("woff2"),url(./media/Roboto-Medium-O2PKKQNT.woff) format("woff"),url(./media/Roboto-Medium-ANIBKV6W.ttf) format("truetype"),url(./media/Roboto-Medium-RJM2M5RS.svg#Roboto) format("svg");font-weight:500;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-MediumItalic-5WUL7G7J.eot);src:local("Roboto MediumItalic"),local("Roboto-MediumItalic"),url(./media/Roboto-MediumItalic-5WUL7G7J.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-MediumItalic-FMJUHMWQ.woff2) format("woff2"),url(./media/Roboto-MediumItalic-EJXCUUAA.woff) format("woff"),url(./media/Roboto-MediumItalic-ZZ274MH6.ttf) format("truetype"),url(./media/Roboto-MediumItalic-WUJRBJ2B.svg#Roboto) format("svg");font-weight:500;font-style:italic}@font-face{font-family:Roboto;src:url(./media/Roboto-Bold-BUUHB5PB.eot);src:local("Roboto Bold"),local("Roboto-Bold"),url(./media/Roboto-Bold-BUUHB5PB.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Bold-NGAPMV26.woff2) format("woff2"),url(./media/Roboto-Bold-GE6V3ZS2.woff) format("woff"),url(./media/Roboto-Bold-5VUU6QI6.ttf) format("truetype"),url(./media/Roboto-Bold-UXMYHWKZ.svg#Roboto) format("svg");font-weight:700;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-BoldItalic-ETKPZE3Z.eot);src:local("Roboto BoldItalic"),local("Roboto-BoldItalic"),url(./media/Roboto-BoldItalic-ETKPZE3Z.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-BoldItalic-TBVJ3OTX.woff2) format("woff2"),url(./media/Roboto-BoldItalic-2CYTLDZJ.woff) format("woff"),url(./media/Roboto-BoldItalic-4MMIXUDR.ttf) format("truetype"),url(./media/Roboto-BoldItalic-TDTZWBKI.svg#Roboto) format("svg");font-weight:700;font-style:italic}@font-face{font-family:Roboto;src:url(./media/Roboto-Black-FJBQ2JLX.eot);src:local("Roboto Black"),local("Roboto-Black"),url(./media/Roboto-Black-FJBQ2JLX.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Black-OEG2WEQ3.woff2) format("woff2"),url(./media/Roboto-Black-AZ2AXCB4.woff) format("woff"),url(./media/Roboto-Black-IGTRSQU4.ttf) format("truetype"),url(./media/Roboto-Black-OEOHVSYK.svg#Roboto) format("svg");font-weight:900;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-BlackItalic-MXNS7VU5.eot);src:local("Roboto BlackItalic"),local("Roboto-BlackItalic"),url(./media/Roboto-BlackItalic-MXNS7VU5.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-BlackItalic-6QYHVQZM.woff2) format("woff2"),url(./media/Roboto-BlackItalic-7QMDFEK5.woff) format("woff"),url(./media/Roboto-BlackItalic-XIXMO2HU.ttf) format("truetype"),url(./media/Roboto-BlackItalic-EYMGZCJW.svg#Roboto) format("svg");font-weight:900;font-style:italic}:root{--blue: #007bff;--indigo: #6610f2;--purple: #6f42c1;--pink: #e83e8c;--red: #dc3545;--orange: #fd7e14;--yellow: #ffc107;--green: #28a745;--teal: #20c997;--cyan: #17a2b8;--white: #fff;--gray: #6c757d;--gray-dark: #343a40;--primary: #007bff;--secondary: #6c757d;--success: #28a745;--info: #17a2b8;--warning: #ffc107;--danger: #dc3545;--light: #f8f9fa;--dark: #343a40;--breakpoint-xs: 0;--breakpoint-sm: 576px;--breakpoint-md: 768px;--breakpoint-lg: 992px;--breakpoint-xl: 1200px;--font-family-sans-serif: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";--font-family-monospace: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}*,*:before,*:after{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,Liberation Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}@media print{*,*:before,*:after{text-shadow:none!important;box-shadow:none!important}img{page-break-inside:avoid}@page{size:a3}body{min-width:992px!important}}body{color:#1e1e1e;font-family:"Roboto","Helvetica Neue",Helvetica,Arial sans-serif;font-size:16px;line-height:1.35em;font-weight:400;background:#F8F8F8}html{overflow-y:scroll}
</style><link rel="stylesheet" href="styles-P6UZRAYA.css" media="all" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles-P6UZRAYA.css"></noscript><link rel="modulepreload" href="chunk-PLZPGUYK.js"><link rel="modulepreload" href="chunk-NTLHVFS2.js"><link rel="modulepreload" href="chunk-CTQXVAHS.js"><link rel="modulepreload" href="chunk-D75ILFX5.js"><link rel="modulepreload" href="chunk-6F2FX2KK.js"><link rel="modulepreload" href="chunk-4NOH4JQB.js"><link rel="modulepreload" href="chunk-N4LXAJXF.js"><meta property="og:title" content="Angular-Buch → TypeScript: useDefineForClassFields – zukünftige Breaking Changes vermeiden"><meta name="twitter:title" content="Angular-Buch → TypeScript: useDefineForClassFields – zukünftige Breaking Changes vermeiden"><meta name="description" content="📙 Wussten Sie bereits, dass Propertys in JavaScript und TypeScript leicht unterschiedlich implementiert sind und es ein inkompatibles Verhalten gibt?
In Projekten mit Angular 15 wird deshalb in der TypeScript-Konfiguration die Option useDefineForClassFields gesetzt.
Wir zeigen Ihnen, was es damit auf sich hat und wie Sie Ihren Code schreiben müssen, damit er zukunftssicher in beiden Programmiersprachen gleich funktioniert."><meta property="og:description" content="📙 Wussten Sie bereits, dass Propertys in JavaScript und TypeScript leicht unterschiedlich implementiert sind und es ein inkompatibles Verhalten gibt?
In Projekten mit Angular 15 wird deshalb in der TypeScript-Konfiguration die Option useDefineForClassFields gesetzt.
Wir zeigen Ihnen, was es damit auf sich hat und wie Sie Ihren Code schreiben müssen, damit er zukunftssicher in beiden Programmiersprachen gleich funktioniert."><meta name="twitter:description" content="📙 Wussten Sie bereits, dass Propertys in JavaScript und TypeScript leicht unterschiedlich implementiert sind und es ein inkompatibles Verhalten gibt?
In Projekten mit Angular 15 wird deshalb in der TypeScript-Konfiguration die Option useDefineForClassFields gesetzt.
Wir zeigen Ihnen, was es damit auf sich hat und wie Sie Ihren Code schreiben müssen, damit er zukunftssicher in beiden Programmiersprachen gleich funktioniert."><meta name="twitter:site" content="@angular_buch"><meta property="og:locale" content="de"><meta property="og:type" content="website"><meta property="og:url" content="https://angular-buch.com/blog/2022-11-use-define-for-class-fields"><style>.width-6{width:6.5rem}.width-8{width:8rem}.linkImage{margin-right:3px;margin-top:-3px}
</style><style>.content img{max-width:100%}.details-page-autor{margin-top:-110px}.details-thumbnail{margin-bottom:-18px}.details-thumbnail .details-thumbnail-inner{border-bottom:23px solid #dfdede;max-height:300px;overflow:hidden;background-color:#fff;border-radius:4px;display:flex;justify-content:center}.details-thumbnail .details-thumbnail-inner .darken-overlay{display:block;position:absolute;height:300px;width:100%;padding-left:15px;padding-right:15px;padding-bottom:23px}.details-thumbnail .details-thumbnail-inner .darken-overlay div{display:block;position:relative;width:100%;height:100%;background-color:#0003;border-radius:4px 4px 0 0/4px 4px 0px 0px}.details-thumbnail img{width:100%;align-self:center}.video-container{position:relative;padding-bottom:56.25%;padding-top:0;height:0;overflow:hidden;margin-top:2rem;margin-bottom:2rem}.video-container iframe,.video-container object,.video-container embed{position:absolute;top:0;left:0;width:100%;height:100%}
</style><meta property="og:image" content="https://website-articles.angular-buch.com/blog/2022-11-use-define-for-class-fields/usedefineforclassfields.jpg"><meta name="twitter:image" content="https://website-articles.angular-buch.com/blog/2022-11-use-define-for-class-fields/usedefineforclassfields.jpg"><meta name="twitter:card" content="summary_large_image"><script>window['ScullyIO']='generated';</script></head>
<body scully-version="0.0.0">
  <app-root ng-version="17.0.3"><header><div class="nav__overlay"></div><div class="container"><div class="row no-gutters align-items-center"><div class="col-6 col-md-2"><a routerlink="/" aria-label="Startseite" href="/"><img src="assets/img/brand-400.png" alt="Angular-Buch.com" height="40" width="126" class="img-fluid"></a></div><div class="col-6 col-md-10"><nav><ul><li><app-link><!----><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/"><!----> Buch </a><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/blog" class="nav__current" aria-current="page"><!----> Blog </a><!----><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/material"><!----> Begleitmaterial </a><!----><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/kaufen"><img alt="" class="linkImage ls-is-cached lazyloaded" data-src="assets/img/symbol-basket.svg" src="assets/img/symbol-basket.svg"><!----> Jetzt kaufen </a><!----><!----><!----></app-link></li><li><app-link><!----><a class="order" href="//angular.schule/"><img alt="" class="linkImage ls-is-cached lazyloaded" data-src="assets/img/symbol-group.svg" src="assets/img/symbol-group.svg"><!----> Schulungen </a><!----><!----><!----><!----></app-link></li><!----></ul></nav><a href="/" aria-label="Navigation" class="nav__toggle"><img src="assets/img/symbol-menu.svg" alt=""></a></div></div></div></header><main><router-outlet></router-outlet><app-blog-details><app-hero-header headline="Blog" headlinelink="/blog"><section class="hero hero--smaller"><div class="hero__lines"><div class="container"><div class="row justify-content-between"><div class="col-md-6 col-xs-12"><h1 class="headline__page headline__page--blank headline__page--space-bottom"><a style="color: white;" href="/blog">Blog</a><!----><!----></h1></div></div></div></div></section><a name="content" id="content"></a></app-hero-header><section class="index index--list blog mt-n5"><div class="index__stripe index__stripe--list"><div class="container"><a name="post" id="post"></a><div class="row details-thumbnail"><div class="col-12"><div class="details-thumbnail-inner"><img alt="" class="img-fluid rounded lazyloaded" data-src="https://website-articles.angular-buch.com/blog/2022-11-use-define-for-class-fields/usedefineforclassfields.jpg" src="https://website-articles.angular-buch.com/blog/2022-11-use-define-for-class-fields/usedefineforclassfields.jpg"><!----></div></div><!----></div><div class="row"><div class="col-12"><div class="index__item index__item--list"><div class="row align-items-top"><div class="col-12 col-sm-3 col-md-2 text-center details-page-autor"><img alt="" class="blog__portrait img-fluid rounded-circle lazyloaded" data-src="//www.gravatar.com/avatar/6a5959f52e095fd1295739672c0781a2?size=200&amp;rating=pg&amp;d=mm" src="//www.gravatar.com/avatar/6a5959f52e095fd1295739672c0781a2?size=200&amp;rating=pg&amp;d=mm"><span class="blog__author">Johannes Hoppe und Ferdinand Malcher <br><a target="_blank" class="twitter" href="https://twitter.com/angular_schule"> @angular_schule</a> &nbsp; <!----></span></div><div class="col-12 col-sm-9 col-md-10 col-lg-10"><h1 class="blog__headline">TypeScript: useDefineForClassFields – zukünftige Breaking Changes vermeiden</h1><p class="blog__date">25.11.2022</p><p class="content markdown-body"><p>Wussten Sie bereits, dass Propertys in JavaScript und TypeScript leicht unterschiedlich implementiert sind und es ein inkompatibles Verhalten gibt?
In Projekten mit Angular 15 wird deshalb in der TypeScript-Konfiguration die Option <code>useDefineForClassFields</code> gesetzt.
Wir zeigen Ihnen, was es damit auf sich hat und wie Sie Ihren Code schreiben müssen, damit er zukunftssicher in beiden Programmiersprachen gleich funktioniert.</p>
<h2 id="inhalt">Inhalt</h2>
<ul>
<li><a href="/blog/2022-11-use-define-for-class-fields#propertys-initialisieren-mit-typescript">Propertys initialisieren mit TypeScript</a></li>
<li><a href="/blog/2022-11-use-define-for-class-fields#das-propriet%C3%A4re-verhalten-von-typescript">Das proprietäre Verhalten von TypeScript</a></li>
<li><a href="/blog/2022-11-use-define-for-class-fields#propertys-zukunftssicher-initialisieren">Propertys zukunftssicher initialisieren</a></li>
<li><a href="/blog/2022-11-use-define-for-class-fields#auswirkungen-auf-bestehenden-angular-code">Auswirkungen auf bestehenden Angular-Code</a></li>
</ul>
<blockquote>
<p><strong>🇬🇧 This article is available in English language here: <a href="https://angular.schule/blog/2022-11-use-define-for-class-fields">TypeScript: useDefineForClassFields – How to avoid future Breaking Changes</a></strong></p>
</blockquote>
<h2 id="propertys-initialisieren-mit-typescript">Propertys initialisieren mit TypeScript</h2>
<p>Bei der Arbeit mit Angular initialisieren wir regelmäßig Propertys in unseren Klassen.
Ein Klassen-Property kann z. B. direkt bei der Deklaration mit einem Wert initialisiert werden.
Außerdem gibt es eine Kurzschreibweise, mit der wir Propertys über den Konstruktor automatisch deklarieren können. 
Diese Kurzform verwendet man in Angular, um Abhängigkeiten mittels Dependency Injection anzufordern.</p>
<pre><code class="language-ts"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  <span class="hljs-comment">// direkte Initialisierung</span>
  age = <span class="hljs-number">25</span>;

  <span class="hljs-comment">// Kurzform</span>
  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> currentYear: <span class="hljs-built_in">number</span></span>)</span> {}
}
</code></pre>
<h2 id="das-proprietäre-verhalten-von-typescript">Das proprietäre Verhalten von TypeScript</h2>
<p>Diese beiden zuvor gezeigten Schreibweisen sind proprietäre Features von TypeScript und existieren schon seit den frühesten Versionen der Sprache.
Die Programmiersprache JavaScript bzw. der Standard ECMAScript unterstützte damals solche Klassen-Propertys nicht vollständig, da die Standardisierung noch nicht abgeschlossen war.
Beim Design der Propertys von TypeScript ging man nach bestem Wissen und Gewissen davon aus, dass die gewählte Implementierung exakt das Verhalten einer zukünftigen Version von JavaScript nachahmen würde.
Das hat leider nicht ganz funktioniert – die Standardisierung in ECMAScript ist über die Jahre einen anderen Weg gegangen.</p>
<p>Die originalen Klassen-Propertys von TypeScript sind so implementiert, dass die Initialisierung mit Werten immer als erste Anweisung im Konstruktor durchgeführt wird.
Die beiden folgenden Schreibweisen waren bislang im Ergebnis absolut identisch:</p>
<pre><code class="language-ts">class <span class="hljs-keyword">User</span> <span class="hljs-title">{
  age</span> = <span class="hljs-number">25</span>;
}

// ist <span class="hljs-keyword">in</span> TypeScript exakt das gleiche wie:
class <span class="hljs-keyword">User</span> <span class="hljs-title">{
  age</span>: <span class="hljs-keyword">number</span>;

  constructor() {
    this.age = <span class="hljs-number">25</span>;
  }
}
</code></pre>
<p>In JavaScript verhalten sich die nativen Klassen-Propertys leider etwas anders:
Es ist möglich, zunächst die Propertys zu initialisieren und erst <em>danach</em> den Konstruktor auszuführen.
Es handelt sich in JavaScript also um zwei voneinander unabhängige Schritte – bei der proprietären Implementierung von TypeScript geschieht die Initialisierung der Propertys hingegen immer zusammen mit dem Aufruf des Konstruktors.</p>
<p>Diese Diskrepanz zwischen TypeScript und JavaScript ist sehr unschön, da TypeScript als Obermenge so weit wie möglich mit JavaScript kompatibel bleiben sollte.
Um die beiden Programmiersprachen wieder einander anzugleichen, hat das TypeScript-Team den Schalter <code>useDefineForClassFields</code> eingeführt.
Sobald das Target von TypeScript auf <code>ES2022</code> gesetzt wird, steht diese Option standardmäßig auf <code>true</code>.
Es wird dadurch im Kompilat die native Implementierung von JavaScript verwendet, und die Propertys verhalten sich im Detail leicht anders als zuvor.
Der folgende Code hat – je nach Einstellung – zwei unterschiedliche Ausgaben:</p>
<pre><code class="language-ts"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{
  age = <span class="hljs-built_in">this</span>.currentYear - <span class="hljs-number">1998</span>;

  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> currentYear: <span class="hljs-built_in">number</span></span>)</span> {
    <span class="hljs-comment">// useDefineForClassFields: false --&gt; Current age: 25</span>
    <span class="hljs-comment">// useDefineForClassFields: true --&gt; Current age: NaN</span>
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Current age:'</span>, <span class="hljs-built_in">this</span>.age);
  }
}

<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> User(<span class="hljs-number">2023</span>);
</code></pre>
<p>Mit dem alten proprietären Verhalten von TypeScript (<code>useDefineForClassFields: false</code>) wird ein Alter von <code>25</code> berechnet, sofern man den Konstruktor der Klasse mit dem Wert <code>2023</code> aufruft.
Der Code hat den folgenden Ablauf:</p>
<ol>
<li>Der Konstruktor wird mit dem aktuellen Jahr aufgerufen.</li>
<li>Der Wert für das aktuelle Jahr wird dem Property <code>currentYear</code> zugewiesen.</li>
<li>Anschließend wird das Property <code>age</code> initialisiert, wobei zur Berechnung alle Werte zur Verfügung stehen.</li>
<li>Auf der Konsole erscheint: <code>Current age: 25</code>.</li>
</ol>
<p>Setzen wir die Option <code>useDefineForClassFields</code> in der Datei <code>tsconfig.json</code> hingegen auf <code>true</code>, erhalten wir als Ergebnis <code>NaN</code>, was für <code>Not a Number</code> steht.
Der Code folgt dann einem anderen Ablauf:</p>
<ol>
<li>Das Property <code>age</code> wird als Erstes initialisiert, wobei zur Berechnung nicht alle Werte zur Verfügung stehen: Zu diesem Zeitpunkt ist das Property <code>currentYear</code> noch <code>undefined</code>, sodass die Subtraktion kein gültiges Ergebnis liefern kann.</li>
<li>Anschließend wird der Konstruktor mit dem aktuellen Jahr aufgerufen.</li>
<li>Der Wert wird dem Property <code>currentYear</code> zugewiesen.</li>
<li>Auf der Konsole erscheint: <code>Current age: NaN</code>.</li>
</ol>
<p>Sie können das unterschiedliche Verhalten in diesem Stackblitz-Beispiel gerne selbst nachvollziehen:<br><strong><a href="https://stackblitz.com/edit/angular-buch-usedefineforclassfields?file=src%2Fapp%2Fapp.component.ts,tsconfig.json">👉 Demo auf Stackblitz: useDefineForClassFields</a></strong></p>
<h2 id="propertys-zukunftssicher-initialisieren">Propertys zukunftssicher initialisieren</h2>
<p>Den zuvor gezeigten Quelltext wollen wir verbessern, sodass er unabhängig von der jeweiligen Einstellung funktioniert.
Dazu führen wir die Initialisierung des Propertys explizit als erste Zeile im Konstruktor durch:</p>
<pre><code class="language-ts"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>  </span>{
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;

  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> currentYear: <span class="hljs-built_in">number</span></span>)</span> {
    <span class="hljs-built_in">this</span>.age = <span class="hljs-built_in">this</span>.currentYear - <span class="hljs-number">1998</span>;
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Current age:'</span>, <span class="hljs-built_in">this</span>.age);
  }
}

<span class="hljs-keyword">const</span> user = <span class="hljs-keyword">new</span> User(<span class="hljs-number">2023</span>);
</code></pre>
<p>Durch diese Schreibweise ist es egal, ob das proprietäre Verhalten von TypeScript oder das standardisierte Verhalten von JavaScript aktiv ist.
Es wird immer das korrekte Ergebnis angezeigt.</p>
<p>Natürlich führt man in realen Projekten eher selten Arithmetik über Propertys durch.
Im Entwicklungsalltag mit Angular ist vor allem dann Vorsicht geboten, wenn wir einen Service innerhalb der Property-Initialisierung verwenden wollen.
Diese Schreibweise birgt die Gefahr, zukünftig nicht mehr zu funktionieren:</p>
<pre><code class="language-ts"><span class="hljs-comment">// ⚠️ ACHTUNG: Dieser Code ist nicht zukunftssicher! ⚠️</span>

<span class="hljs-meta">@Component({ /* ... */ })</span>
export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> </span>{
  <span class="hljs-comment">// this.myService könnte undefined sein!</span>
  <span class="hljs-keyword">data</span> = <span class="hljs-keyword">this</span>.myService.getData();

  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> myService: MyDataService) { }
}
</code></pre>
<p>Um das Problem zu umgehen, sollten wir die Initialisierung grundsätzlich im Konstruktor durchführen.
So ist unser Code zukunftssicher:</p>
<pre><code class="language-ts"><span class="hljs-meta">@Component({ /* ... */ })</span>
export <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyComponent</span> </span>{
  <span class="hljs-keyword">data</span>: Data;

  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> myService: MyDataService) {
    <span class="hljs-keyword">this</span>.<span class="hljs-keyword">data</span> = <span class="hljs-keyword">this</span>.myService.getData();
  }
}
</code></pre>
<p>Alternativ ist es möglich, die Abhängigkeit gar nicht über den Konstruktor anzufordern, sondern die Funktion <code>inject()</code> einzusetzen, mit der man ebenso Dependency Injection durchführen kann.
Benötigen wir die Serviceinstanz mehrfach, können wir die angeforderte Abhängigkeit in einem Property ablegen und von überall in der Klasse aus verwenden.</p>
<pre><code class="language-ts"><span class="hljs-keyword">import</span> { <span class="hljs-keyword">inject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;

@Component({ <span class="hljs-comment">/* ... */</span> })
export <span class="hljs-keyword">class</span> MyComponent {
  data = <span class="hljs-keyword">inject</span>(MyDataService).getData();
  otherService = <span class="hljs-keyword">inject</span>(MyOtherService);
}
</code></pre>
<blockquote>
<p><strong>Tipp:</strong> Wenn wir bei der direkten Initialisierung von Propertys auf injizierte Services zugreifen wollen, sollten wir</p>
<ul>
<li>die Initialisierung im Konstruktor durchführen oder</li>
<li>die Funktion <code>inject()</code> verwenden.</li>
</ul>
</blockquote>
<h2 id="auswirkungen-auf-bestehenden-angular-code">Auswirkungen auf bestehenden Angular-Code</h2>
<p>Die gewählte Einstellung für <code>useDefineForClassFields</code> hat eine große Tragweite.
Würde man den Schalter bei bestehenden Angular-Projekten in der Standardeinstellung belassen, so würde es mit sehr hoher Wahrscheinlichkeit an vielen Stellen zu Fehlern kommen.
Daher hat das Angular-Team sowohl für bestehende als auch für neue Projekte die Einstellung mit Angular 15 explizit deaktiviert.
In der Datei <code>tsconfig.json</code> finden wir dazu die folgenden Angaben:</p>
<pre><code class="language-json">{
  <span class="hljs-attr">"compilerOptions"</span>: {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-attr">"useDefineForClassFields"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"target"</span>: <span class="hljs-string">"ES2022"</span>
  }
}
</code></pre>
<p>Das seit vielen Jahren bekannte proprietäre Verhalten bleibt also vorerst bestehen.</p>
<p>Üblicherweise folgt Angular aber den Empfehlungen und Vorgaben von TypeScript.
So wurden z. B. in der Vergangenheit die strikten Typprüfungen für neue Projekte standardmäßig aktiviert.
Es ist davon auszugehen, dass in Angular irgendwann einmal die Einstellung <code>useDefineForClassFields</code> auf den Standardwert <code>true</code> gesetzt wird.
Wir empfehlen Ihnen also, Ihren Code jetzt schon möglichst robust zu entwickeln und bereits heute die Einstellung von <code>useDefineForClassFields</code> auf <code>true</code> zu setzen.
Sollte in Zukunft die Standardeinstellung für geändert werden, so sind Sie dann von keinem Breaking Change betroffen!</p>
<h2 id="neue-auflage-des-angular-buchs">Neue Auflage des Angular-Buchs</h2>
<p>Wir haben in den letzten Monaten intensiv an einer Neuauflage des deutschsprachigen Angular-Buchs gearbeitet!
Natürlich haben wir vorsorglich alle Quelltexte im Angular-Buch so geschrieben, dass sie bereits zukunftssicher funktionieren. 
Die Inhalte dieses Blogposts haben wir aus unserem Buch übernommen.
Wenn Sie diesen Text hilfreich fanden, dann sollten Sie unbedingt das neue <a href="/kaufen">Angular-Buch bestellen</a>.</p>
<div style="text-align: center">
<img src="https://angular-buch.com/assets/img/book-cover-multiple-v4.png" alt="Buchcover 4. Auflage" style="width:500px">
</div>



<hr>

<p><small><strong>Titelbild:</strong> Mols Bjerge Nationalpark, Dänemark, 2022. Foto von Ferdinand Malcher</small></p>
</p><!----><!----><a routerlink="/blog" ripple-radius="" class="btn btn-sm btn-primary mt-4" href="/blog"><i class="fa fa-backward mr-2"></i> Zurück</a><hr> Suggestions? Feedback? Bugs? Please <a target="_blank" class="content" href="https://github.com/angular-buch/website-articles/blob/gh-pages/blog/2022-11-use-define-for-class-fields/README.md"><i class="fa fa-github mr-1" style="font-size: 1.6rem; position: relative; bottom: -3px;"></i>fork/edit this page on Github</a>. </div></div></div></div></div><!----></div><!----><!----></div></section><app-json-ld><script type="application/ld+json">{
  "url": "https://angular.schule/blog/2022-11-use-define-for-class-fields",
  "headline": "TypeScript: useDefineForClassFields – zukünftige Breaking Changes vermeiden",
  "description": "Wussten Sie bereits, dass Propertys in JavaScript und TypeScript leicht unterschiedlich implementiert sind und es ein inkompatibles Verhalten gibt?\nIn Projekten mit Angular 15 wird deshalb in der TypeScript-Konfiguration die Option useDefineForClassFields gesetzt.\nWir zeigen Ihnen, was es damit auf sich hat und wie Sie Ihren Code schreiben müssen, damit er zukunftssicher in beiden Programmiersprachen gleich funktioniert.",
  "datePublished": "2022-11-25",
  "dateModified": "2022-11-25",
  "publisher": {
    "name": "Angular-Buch",
    "url": "https://angular-buch.com",
    "@type": "Organization",
    "logo": {
      "@type": "ImageObject",
      "url": "https://angular-buch.com/assets/img/brand_export.png"
    }
  },
  "image": "https://website-articles.angular-buch.com/blog/2022-11-use-define-for-class-fields/usedefineforclassfields.jpg",
  "thumbnailUrl": "https://website-articles.angular-buch.com/blog/2022-11-use-define-for-class-fields/usedefineforclassfields.jpg",
  "author": {
    "@type": "Person",
    "name": "Johannes Hoppe und Ferdinand Malcher",
    "email": "team@angular.schule"
  },
  "keywords": [
    "Angular",
    "JavaScript",
    "ECMAScript",
    "TypeScript",
    "ES2022",
    "Klassen-Propertys",
    "useDefineForClassFields"
  ],
  "mainEntityOfPage": "http://schema.org/WebPage",
  "@type": "Article",
  "@context": "http://schema.org"
}</script></app-json-ld></app-blog-details><!----><footer><div class="container"><div class="row align-items-center"><div class="col-sm-9"><div class="links"><app-link><!----><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/"><!----> Home </a><!----><!----></app-link>|<!----><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/impressum"><!----> Impressum </a><!----><!----><!----></app-link>|<!----><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/datenschutz"><!----> Datenschutzerklärung </a><!----><!----><!----></app-link>|<!----><app-link><!----><a class="links__item links__twitter" href="https://twitter.com/angular_buch" rel="nofollow"><!----> Twitter </a><!----><!----><!----><!----></app-link><!----><!----></div></div><div class="col-sm-3 text-right"></div></div></div></footer></main><app-json-ld><script type="application/ld+json"></script></app-json-ld></app-root>
<script src="polyfills-LZBJRJJE.js" type="module"></script><script src="main-GFJ25HMQ.js" type="module"></script>

</body></html>