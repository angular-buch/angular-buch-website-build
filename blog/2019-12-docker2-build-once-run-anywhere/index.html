<!DOCTYPE html><html lang="de" data-critters-container=""><head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#"><meta name="generator" content="Scully 0.0.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <title>Angular-Buch â†’ [Docker Serie 3/4] Build Once, Run Anywhere oder: Konfiguration Ã¼ber Docker verwalten</title>
  

  

  <meta property="book:author" content="https://www.facebook.com/ferdinand.malcher">
  <meta property="book:author" content="https://www.facebook.com/johannes.hoppe">

  <meta property="book:isbn" content="9783864909467">
  <meta property="book:release_date" content="2023-02-28">
  <meta property="book:tag" content="Angular">
  <meta property="book:tag" content="Webentwicklung">
  <meta property="book:tag" content="AngularJS">
  <meta property="book:tag" content="TypeScript">
  <meta property="book:tag" content="JavaScript">
  <meta property="book:tag" content="HTML5">
  <meta property="book:tag" content="CSS">
  <meta property="book:tag" content="RxJS">
  <meta property="book:tag" content="Redux">
  <meta property="book:tag" content="NgRx">

  <base href="/">
<style>@charset "UTF-8";@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@font-face{font-family:Roboto;src:url("./media/Roboto-Thin-GAS35NAQ.eot");src:local("Roboto Thin"),local("Roboto-Thin"),url("./media/Roboto-Thin-GAS35NAQ.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-Thin-UUU7IP4L.woff2") format("woff2"),url("./media/Roboto-Thin-BT5WDCMC.woff") format("woff"),url("./media/Roboto-Thin-STLHGJGZ.ttf") format("truetype"),url("./media/Roboto-Thin-OYOYLS5N.svg#Roboto") format("svg");font-weight:100;font-style:normal}@font-face{font-family:Roboto;src:url("./media/Roboto-ThinItalic-HQCJJ3KQ.eot");src:local("Roboto ThinItalic"),local("Roboto-ThinItalic"),url("./media/Roboto-ThinItalic-HQCJJ3KQ.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-ThinItalic-PVCCLVHZ.woff2") format("woff2"),url("./media/Roboto-ThinItalic-OJCFQICS.woff") format("woff"),url("./media/Roboto-ThinItalic-OKVQEY6M.ttf") format("truetype"),url("./media/Roboto-ThinItalic-PU7U6F54.svg#Roboto") format("svg");font-weight:100;font-style:italic}@font-face{font-family:Roboto;src:url("./media/Roboto-Light-TT7V6J7W.eot");src:local("Roboto Light"),local("Roboto-Light"),url("./media/Roboto-Light-TT7V6J7W.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-Light-OEL5QP53.woff2") format("woff2"),url("./media/Roboto-Light-EGEOUPZ7.woff") format("woff"),url("./media/Roboto-Light-KYCYMX5R.ttf") format("truetype"),url("./media/Roboto-Light-O5NB3DZS.svg#Roboto") format("svg");font-weight:300;font-style:normal}@font-face{font-family:Roboto;src:url("./media/Roboto-LightItalic-JJ225GLJ.eot");src:local("Roboto LightItalic"),local("Roboto-LightItalic"),url("./media/Roboto-LightItalic-JJ225GLJ.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-LightItalic-SZU3UOEY.woff2") format("woff2"),url("./media/Roboto-LightItalic-5LJGTDBY.woff") format("woff"),url("./media/Roboto-LightItalic-ZTOFFLND.ttf") format("truetype"),url("./media/Roboto-LightItalic-FE5GYQJO.svg#Roboto") format("svg");font-weight:300;font-style:italic}@font-face{font-family:Roboto;src:url("./media/Roboto-Regular-WINA5356.eot");src:local("Roboto Regular"),local("Roboto-Regular"),url("./media/Roboto-Regular-WINA5356.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-Regular-4ZFX4XNS.woff2") format("woff2"),url("./media/Roboto-Regular-EMJ7NDAQ.woff") format("woff"),url("./media/Roboto-Regular-W6LM4ZNI.ttf") format("truetype"),url("./media/Roboto-Regular-DDBAS5OS.svg#Roboto") format("svg");font-weight:400;font-style:normal}@font-face{font-family:Roboto;src:url("./media/Roboto-RegularItalic-43QNLNAN.eot");src:local("Roboto RegularItalic"),local("Roboto-RegularItalic"),url("./media/Roboto-RegularItalic-43QNLNAN.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-RegularItalic-2REFJECD.woff2") format("woff2"),url("./media/Roboto-RegularItalic-NSJ4HBKT.woff") format("woff"),url("./media/Roboto-RegularItalic-YZDJVEXU.ttf") format("truetype"),url("./media/Roboto-RegularItalic-7A3VJZ2J.svg#Roboto") format("svg");font-weight:400;font-style:italic}@font-face{font-family:Roboto;src:url("./media/Roboto-Medium-TKOJIIN4.eot");src:local("Roboto Medium"),local("Roboto-Medium"),url("./media/Roboto-Medium-TKOJIIN4.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-Medium-GHCC3HN6.woff2") format("woff2"),url("./media/Roboto-Medium-O2PKKQNT.woff") format("woff"),url("./media/Roboto-Medium-ANIBKV6W.ttf") format("truetype"),url("./media/Roboto-Medium-RJM2M5RS.svg#Roboto") format("svg");font-weight:500;font-style:normal}@font-face{font-family:Roboto;src:url("./media/Roboto-MediumItalic-5WUL7G7J.eot");src:local("Roboto MediumItalic"),local("Roboto-MediumItalic"),url("./media/Roboto-MediumItalic-5WUL7G7J.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-MediumItalic-FMJUHMWQ.woff2") format("woff2"),url("./media/Roboto-MediumItalic-EJXCUUAA.woff") format("woff"),url("./media/Roboto-MediumItalic-ZZ274MH6.ttf") format("truetype"),url("./media/Roboto-MediumItalic-WUJRBJ2B.svg#Roboto") format("svg");font-weight:500;font-style:italic}@font-face{font-family:Roboto;src:url("./media/Roboto-Bold-BUUHB5PB.eot");src:local("Roboto Bold"),local("Roboto-Bold"),url("./media/Roboto-Bold-BUUHB5PB.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-Bold-NGAPMV26.woff2") format("woff2"),url("./media/Roboto-Bold-GE6V3ZS2.woff") format("woff"),url("./media/Roboto-Bold-5VUU6QI6.ttf") format("truetype"),url("./media/Roboto-Bold-UXMYHWKZ.svg#Roboto") format("svg");font-weight:700;font-style:normal}@font-face{font-family:Roboto;src:url("./media/Roboto-BoldItalic-ETKPZE3Z.eot");src:local("Roboto BoldItalic"),local("Roboto-BoldItalic"),url("./media/Roboto-BoldItalic-ETKPZE3Z.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-BoldItalic-TBVJ3OTX.woff2") format("woff2"),url("./media/Roboto-BoldItalic-2CYTLDZJ.woff") format("woff"),url("./media/Roboto-BoldItalic-4MMIXUDR.ttf") format("truetype"),url("./media/Roboto-BoldItalic-TDTZWBKI.svg#Roboto") format("svg");font-weight:700;font-style:italic}@font-face{font-family:Roboto;src:url("./media/Roboto-Black-FJBQ2JLX.eot");src:local("Roboto Black"),local("Roboto-Black"),url("./media/Roboto-Black-FJBQ2JLX.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-Black-OEG2WEQ3.woff2") format("woff2"),url("./media/Roboto-Black-AZ2AXCB4.woff") format("woff"),url("./media/Roboto-Black-IGTRSQU4.ttf") format("truetype"),url("./media/Roboto-Black-OEOHVSYK.svg#Roboto") format("svg");font-weight:900;font-style:normal}@font-face{font-family:Roboto;src:url("./media/Roboto-BlackItalic-MXNS7VU5.eot");src:local("Roboto BlackItalic"),local("Roboto-BlackItalic"),url("./media/Roboto-BlackItalic-MXNS7VU5.eot?#iefix") format("embedded-opentype"),url("./media/Roboto-BlackItalic-6QYHVQZM.woff2") format("woff2"),url("./media/Roboto-BlackItalic-7QMDFEK5.woff") format("woff"),url("./media/Roboto-BlackItalic-XIXMO2HU.ttf") format("truetype"),url("./media/Roboto-BlackItalic-EYMGZCJW.svg#Roboto") format("svg");font-weight:900;font-style:italic}:root{--blue: #007bff;--indigo: #6610f2;--purple: #6f42c1;--pink: #e83e8c;--red: #dc3545;--orange: #fd7e14;--yellow: #ffc107;--green: #28a745;--teal: #20c997;--cyan: #17a2b8;--white: #fff;--gray: #6c757d;--gray-dark: #343a40;--primary: #007bff;--secondary: #6c757d;--success: #28a745;--info: #17a2b8;--warning: #ffc107;--danger: #dc3545;--light: #f8f9fa;--dark: #343a40;--breakpoint-xs: 0;--breakpoint-sm: 576px;--breakpoint-md: 768px;--breakpoint-lg: 992px;--breakpoint-xl: 1200px;--font-family-sans-serif: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";--font-family-monospace: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}*,*:before,*:after{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,Liberation Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}@media print{*,*:before,*:after{text-shadow:none!important;box-shadow:none!important}img{page-break-inside:avoid}@page{size:a3}body{min-width:992px!important}}body{color:#1e1e1e;font-family:"Roboto","Helvetica Neue",Helvetica,Arial sans-serif;font-size:16px;line-height:1.35em;font-weight:400;background:#f8f8f8}html{overflow-y:scroll}
</style><link rel="stylesheet" href="styles-24WBZHAI.css" media="all" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles-24WBZHAI.css"></noscript><link rel="modulepreload" href="chunk-NATMASFH.js"><link rel="modulepreload" href="chunk-GG7MI7Z3.js"><link rel="modulepreload" href="chunk-7AOEDJ7X.js"><link rel="modulepreload" href="chunk-WXI33M2S.js"><link rel="modulepreload" href="chunk-FOH2WTW5.js"><link rel="modulepreload" href="chunk-DWFE37FD.js"><link rel="modulepreload" href="chunk-UCVTEUC6.js"><meta property="og:title" content="Angular-Buch â†’ [Docker Serie 3/4] Build Once, Run Anywhere oder: Konfiguration Ã¼ber Docker verwalten"><meta name="twitter:title" content="Angular-Buch â†’ [Docker Serie 3/4] Build Once, Run Anywhere oder: Konfiguration Ã¼ber Docker verwalten"><meta name="description" content="ðŸ“™ Build Once, Run Anywhere:
Wie Sie ein einziges Image zur Laufzeit an beliebige Umgebungen anpassen.
Bleiben Sie auch ohne Code-Ã„nderung flexibel!
Dies ist der 3. Teil unserer vierteiligen Artikelserie zu Angular und Docker."><meta property="og:description" content="ðŸ“™ Build Once, Run Anywhere:
Wie Sie ein einziges Image zur Laufzeit an beliebige Umgebungen anpassen.
Bleiben Sie auch ohne Code-Ã„nderung flexibel!
Dies ist der 3. Teil unserer vierteiligen Artikelserie zu Angular und Docker."><meta name="twitter:description" content="ðŸ“™ Build Once, Run Anywhere:
Wie Sie ein einziges Image zur Laufzeit an beliebige Umgebungen anpassen.
Bleiben Sie auch ohne Code-Ã„nderung flexibel!
Dies ist der 3. Teil unserer vierteiligen Artikelserie zu Angular und Docker."><meta name="twitter:site" content="@angular_buch"><meta property="og:locale" content="de"><meta property="og:type" content="website"><meta property="og:url" content="https://angular-buch.com/blog/2019-12-docker2-build-once-run-anywhere"><style>.width-6{width:6.5rem}.width-8{width:8rem}.linkImage{margin-right:3px;margin-top:-3px}
</style><style>.content img{max-width:100%}.details-page-autor{margin-top:-110px}.details-thumbnail{margin-bottom:-18px}.details-thumbnail .details-thumbnail-inner{border-bottom:23px solid #dfdede;max-height:300px;overflow:hidden;background-color:#fff;border-radius:4px;display:flex;justify-content:center}.details-thumbnail .details-thumbnail-inner .darken-overlay{display:block;position:absolute;height:300px;width:100%;padding-left:15px;padding-right:15px;padding-bottom:23px}.details-thumbnail .details-thumbnail-inner .darken-overlay div{display:block;position:relative;width:100%;height:100%;background-color:#0003;border-radius:4px 4px 0 0/4px 4px 0px 0px}.details-thumbnail img{width:100%;align-self:center}.video-container{position:relative;padding-bottom:56.25%;padding-top:0;height:0;overflow:hidden;margin-top:2rem;margin-bottom:2rem}.video-container iframe,.video-container object,.video-container embed{position:absolute;top:0;left:0;width:100%;height:100%}
</style><meta property="og:image" content="https://website-articles.angular-buch.com/blog/2019-12-docker2-build-once-run-anywhere/header2.jpg"><meta name="twitter:image" content="https://website-articles.angular-buch.com/blog/2019-12-docker2-build-once-run-anywhere/header2.jpg"><meta name="twitter:card" content="summary_large_image"><script>window['ScullyIO']='generated';</script></head>
<body scully-version="0.0.0">
  <app-root ng-version="17.3.1"><header><div class="nav__overlay"></div><div class="container"><div class="row no-gutters align-items-center"><div class="col-6 col-md-2"><a routerlink="/" aria-label="Startseite" href="/"><img src="assets/img/brand-400.png" alt="Angular-Buch.com" height="40" width="126" class="img-fluid"></a></div><div class="col-6 col-md-10"><nav><ul><li><app-link><!----><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/"><!----> Buch </a><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/blog" class="nav__current" aria-current="page"><!----> Blog </a><!----><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/material"><!----> Begleitmaterial </a><!----><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/kaufen"><img alt="" class="linkImage ls-is-cached lazyloaded" data-src="assets/img/symbol-basket.svg" src="assets/img/symbol-basket.svg"><!----> Jetzt kaufen </a><!----><!----><!----></app-link></li><li><app-link><!----><a class="order" href="//angular.schule/"><img alt="" class="linkImage ls-is-cached lazyloaded" data-src="assets/img/symbol-group.svg" src="assets/img/symbol-group.svg"><!----> Schulungen </a><!----><!----><!----><!----></app-link></li><!----></ul></nav><a href="/" aria-label="Navigation" class="nav__toggle"><img src="assets/img/symbol-menu.svg" alt=""></a></div></div></div></header><main><router-outlet></router-outlet><app-blog-details><app-hero-header headline="Blog" headlinelink="/blog"><section class="hero hero--smaller"><div class="hero__lines"><div class="container"><div class="row justify-content-between"><div class="col-md-6 col-xs-12"><h1 class="headline__page headline__page--blank headline__page--space-bottom"><a style="color: white;" href="/blog">Blog</a><!----><!----></h1></div></div></div></div></section><a name="content" id="content"></a></app-hero-header><section class="index index--list blog mt-n5"><div class="index__stripe index__stripe--list"><div class="container"><a name="post" id="post"></a><div class="row details-thumbnail"><div class="col-12"><div class="details-thumbnail-inner"><img alt="" class="img-fluid rounded lazyloaded" data-src="https://website-articles.angular-buch.com/blog/2019-12-docker2-build-once-run-anywhere/header2.jpg" src="https://website-articles.angular-buch.com/blog/2019-12-docker2-build-once-run-anywhere/header2.jpg"><!----></div></div><!----></div><div class="row"><div class="col-12"><div class="index__item index__item--list"><div class="row align-items-top"><div class="col-12 col-sm-3 col-md-2 text-center details-page-autor"><img alt="" class="blog__portrait img-fluid rounded-circle lazyloaded" data-src="//www.gravatar.com/avatar/4d89f498c1a638682a07b73648c0d3b5?size=200&amp;rating=pg&amp;d=mm" src="//www.gravatar.com/avatar/4d89f498c1a638682a07b73648c0d3b5?size=200&amp;rating=pg&amp;d=mm"><span class="blog__author">Michael Kaaden <br><a target="_blank" class="twitter" href="https://twitter.com/angular_schule"> @angular_schule</a> &nbsp; <!----></span></div><div class="col-12 col-sm-9 col-md-10 col-lg-10"><h1 class="blog__headline">[Docker Serie 3/4] Build Once, Run Anywhere oder: Konfiguration Ã¼ber Docker verwalten</h1><p class="blog__date">16.12.2019</p><p class="content markdown-body"><p><strong>Build Once, Run Anywhere:
Wie Sie ein einziges Image zur Laufzeit an beliebige Umgebungen anpassen.
Bleiben Sie auch ohne Code-Ã„nderung flexibel!
Dies ist der 3. Teil unserer vierteiligen Artikelserie zu Angular und Docker.</strong></p>
<p>Inhaltsverzeichnis:</p>
<ul>
<li><a href="/blog/2019-12-docker2-build-once-run-anywhere#motivation">Motivation</a></li>
<li><a href="/blog/2019-12-docker2-build-once-run-anywhere#anforderungen-an-die-konfigurierbarkeit">Anforderungen an die Konfigurierbarkeit</a></li>
<li><a href="/blog/2019-12-docker2-build-once-run-anywhere#konfigurierbarkeit-umsetzen">Konfigurierbarkeit umsetzen</a></li>
<li><a href="/blog/2019-12-docker2-build-once-run-anywhere#umgebung-mit-docker-konfigurieren">Umgebung mit Docker konfigurieren</a></li>
<li><a href="/blog/2019-12-docker2-build-once-run-anywhere#ausblick">Ausblick</a></li>
</ul>
<p>Sie finden den Code zum Artikel auf
<a href="https://github.com/MichaelKaaden/dockerized-app/tree/master/Part-2-Build-Once-Run-Anywhere">GitHub</a>.</p>
<p>In Teil I dieser Artikelserie haben Sie gelernt, wie Sie Ihre Angular-App in ein Docker-Image packen und in einem Container zur AusfÃ¼hrung bringen kÃ¶nnen.</p>
<h2 id="motivation">Motivation</h2>
<p>Die meisten Angular-Apps werden Daten abfragen und/oder persistieren.
Sie benÃ¶tigen also ein Backend, meist in Gestalt eines RESTful Web Service.
Die App spricht das Backend Ã¼ber einen URL an, der irgendwo in der App abgelegt sein muss.
Das Angular-Team <a href="https://angular.io/guide/build">stellt sich vor</a>, dass Sie diesen URL in <code>src/environments/environment.ts</code> bzw. <code>src/environments/environment.prod.ts</code> ablegen, beispielsweise unter dem Namen
<code>baseUrl</code>.</p>
<p>Das klappt gut, solange Sie mit diesen beiden Umgebungen auskommen.
Gerade wenn Sie in einem Team entwickeln, werden Sie jedoch mindestens vier Umgebungen verwenden:</p>
<ul>
<li><em>Development</em> zum Entwickeln,</li>
<li><em>Testing</em> fÃ¼r Integrations- und Systemtests sowie manuelle Tests,</li>
<li><em>Staging</em> fÃ¼r die Produktabnahme und schlieÃŸlich</li>
<li><em>Production</em> fÃ¼r den Produktivbetrieb.</li>
</ul>
<p>Jede dieser Umgebungen hat typischerweise ihr eigenes Backend und benÃ¶tigt somit einen spezifischen <code>baseUrl</code>.
In der RealitÃ¤t werden Sie noch mehr zu konfigurieren haben, etwa einen Identity Provider fÃ¼r die Autorisierung.
Weitere Konfigurationsoptionen fÃ¼gen allerdings diesem Artikel keinen Mehrwert hinzu, weshalb ich mich auf den <code>baseUrl</code> beschrÃ¤nke.</p>
<p>Sie sehen schon: Mit nur <code>environment.ts</code> und <code>environment.prod.ts</code> kommen wir da nicht ganz hin. NatÃ¼rlich kÃ¶nnten wir noch ein <code>environment.testing.ts</code> und ein <code>environment.staging.ts</code> definieren, doch das hilft uns nicht weiter, wie wir gleich sehen werden.</p>
<h2 id="anforderungen-an-die-konfigurierbarkeit">Anforderungen an die Konfigurierbarkeit</h2>
<p>In der <em>Development</em>-Umgebung soll die App ganz normal mit <code>ng serve</code> bzw. <code>ng serve --prod</code> laufen kÃ¶nnen.
Wir brauchen also eine LÃ¶sung, die den <code>baseUrl</code> auch ohne Docker zur VerfÃ¼gung stellt.</p>
<p>In den anderen Umgebungen mÃ¶chten wir den jeweils passenden <code>baseUrl</code> nutzen.
Eine wesentliche EinschrÃ¤nkung dabei ist: Wir dÃ¼rfen nicht damit anfangen, nur wegen eines jeweils anderen <code>baseUrl</code> ein Image je Umgebung zu erstellen.</p>
<p>Wenn ein Image in <em>Testing</em> fÃ¼r gut befunden wurde, egal ob durch automatische oder manuelle Tests, dann ist genau dieses Image dasjenige, das nach <em>Staging</em> und nach erfolgreicher Abnahme nach <em>Production</em> wandern soll. Wir dÃ¼rfen <em>kein</em> neues Image erstellen, denn das kÃ¶nnte geringfÃ¼gig anders sein als das getestete, beispielsweise weil in der Zwischenzeit Ihre geschÃ¤tzten Admin-Kollegen automatisiert eine neue Version von Node.js auf Ihrem Rechner eingespielt haben. Vielleicht haben Sie auch Ihre globalen NPM-Pakete aktualisiert.
Oder ein Kollege hat stillschweigend einen Fix in die Sourcen eingebaut.</p>
<p>Wenn aber das Image aus <em>Testing</em> auch fÃ¼r <em>Staging</em> und <em>Production</em> verwendet werden soll, heiÃŸt das, dass der <code>baseUrl</code> nicht Teil des Images sein darf, sondern von auÃŸen Ã¼ber Docker konfigurierbar sein muss.</p>
<p>Zusammengefasst benÃ¶tigen wir also eine LÃ¶sung, die uns in der <em>Development</em>-Umgebung einen <code>baseUrl</code> auch ohne Docker zur VerfÃ¼gung stellt, die uns aber einen Weg ebnet, den <code>baseUrl</code> fÃ¼r die anderen Umgebungen mit
Docker zu konfigurieren.</p>
<h2 id="konfigurierbarkeit-umsetzen">Konfigurierbarkeit umsetzen</h2>
<p>Um diese Anforderungen umsetzen zu kÃ¶nnen, benÃ¶tigen wir einen Mechanismus, der die Konfiguration der App erst zur Laufzeit lÃ¤dt. WÃ¼rden wir das <code>environment.ts</code> fÃ¼r diesen Zweck nutzen, dann mÃ¼sste die Konfiguration schon
beim <em>Build</em> feststehen, was aber nicht sein darf, wie wir im vorangehenden Abschnitt festgestellt haben.</p>
<p>Eine gute LÃ¶sung ist, die Konfiguration in eine Datei zu packen, die wir im <code>assets</code>-Verzeichnis ablegen und von dort zusammen mit der App laden.
Auf diese Weise kÃ¶nnen wir diese Konfigurationsdatei beim Start des Containers beliebig Ã¼berschreiben.
Wir Ã¤ndern die Konfiguration dadurch zur <em>Laufzeit</em> â€“ wir sehen gleich, wie wir das bewerkstelligen.</p>
<p>Nachfolgende sehen Sie die Datei <code>src/assets/settings.json</code>, die wir zu diesem Zweck verwenden
werden.</p>
<pre><code class="language-json">{
    <span class="hljs-attr">"baseUrl"</span>: <span class="hljs-string">"http://localhost:5002"</span>
}
</code></pre>
<p>AnschlieÃŸend definieren Sie mittels <code>ng g class models/settings --skip-tests</code> in der Datei
<code>settings.ts</code> ein Interface, das die Struktur dieser Konfigurationsdatei vorgibt:</p>
<pre><code class="language-typescript">export <span class="hljs-keyword">interface</span> <span class="hljs-symbol">Settings</span> {
    baseUrl: <span class="hljs-built_in">string</span>;
}
</code></pre>
<p>Jetzt benÃ¶tigen wir noch einen Service, den wir Ã¼berall dort injizieren kÃ¶nnen, wo wir Zugriff auf die Konfiguration benÃ¶tigen.
Wir erstellen diesen <code>SettingsService</code> mit der Angular CLI: <code>ng g service services/settings</code>.</p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Injectable } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { Settings } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/settings"</span>;

@Injectable({
    providedIn: <span class="hljs-string">"root"</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SettingsService</span> {</span>
    settings: Settings;
}
</code></pre>
<p>AuÃŸerdem wollen wir einen Service definieren, der fÃ¼r das Laden unserer <code>settings.json</code> verantwortlich ist.
Der Service soll spÃ¤ter direkt von Angular genutzt werden, daher legen wir diese Mechanik nicht im <code>SettingsService</code> ab.
Der neue Service wird generiert mit dem Befehl <code>ng g service services/settings-initializer</code>.
Er soll eine Methode <code>initializeSettings()</code> beinhalten, die eine Promise zurÃ¼ckgibt:</p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { HttpClient } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/common/http"</span>;
<span class="hljs-keyword">import</span> { Injectable } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { Settings } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/settings"</span>;
<span class="hljs-keyword">import</span> { SettingsService } <span class="hljs-keyword">from</span> <span class="hljs-string">"./settings.service"</span>;

<span class="hljs-meta">@Injectable</span>({
    <span class="hljs-attr">providedIn</span>: <span class="hljs-string">"root"</span>,
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SettingsInitializerService</span> </span>{
    <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> http: HttpClient, <span class="hljs-keyword">private</span> settings: SettingsService</span>)</span> {}

    initializeSettings(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
            <span class="hljs-built_in">this</span>.http.get(<span class="hljs-string">"assets/settings.json"</span>).subscribe(
                <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
                    <span class="hljs-built_in">this</span>.settings.settings = response <span class="hljs-keyword">as</span> Settings;
                    resolve();
                },
                <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> reject(error),
            );
        });
    }
}
</code></pre>
<p>Von Angular sind Sie es gewohnt, mit Observables zu arbeiten.
Daher wundern Sie sich eventuell Ã¼ber den RÃ¼ckgabetyp von <code>initializeSettings()</code>.
Des RÃ¤tsels LÃ¶sung ist ganz einfach:
Der Mechanismus, Ã¼ber den wir in KÃ¼rze alles miteinander verdrahten, erwartet an der Stelle ausschlieÃŸlich ein Promise.</p>
<p>Der zugehÃ¶rige Unit-Test sieht folgendermaÃŸen aus:</p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> {
    HttpClientTestingModule,
    HttpTestingController,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/common/http/testing"</span>;
<span class="hljs-keyword">import</span> { TestBed } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core/testing"</span>;
<span class="hljs-keyword">import</span> { Settings } <span class="hljs-keyword">from</span> <span class="hljs-string">"../models/settings"</span>;

<span class="hljs-keyword">import</span> { SettingsInitializerService } <span class="hljs-keyword">from</span> <span class="hljs-string">"./settings-initializer.service"</span>;
<span class="hljs-keyword">import</span> { SettingsService } <span class="hljs-keyword">from</span> <span class="hljs-string">"./settings.service"</span>;

describe(<span class="hljs-string">"SettingsInitializerService"</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    let service: SettingsInitializerService;
    let httpMock: HttpTestingController;
    let settingsService: SettingsService;

    const testSettings: Settings = {
        baseUrl: <span class="hljs-string">"baseUrl"</span>,
    };

    beforeEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        TestBed.configureTestingModule({
            imports: [HttpClientTestingModule],
        });

        service = TestBed.get(SettingsInitializerService);
        httpMock = TestBed.get(HttpTestingController);
        settingsService = TestBed.get(SettingsService);
    });

    afterEach(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        httpMock.verify();
    });

    it(<span class="hljs-string">"should be created"</span>, <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
        expect(service).toBeTruthy();
    });

    it(<span class="hljs-string">"should initialize settings"</span>, <span class="hljs-function"><span class="hljs-params">(done)</span> =&gt;</span> {
        service.initializeSettings().<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
            expect(settingsService.settings).toEqual(testSettings);
            done();
        });

        const request = httpMock.expectOne(<span class="hljs-string">"assets/settings.json"</span>);
        expect(request.request.method).toBe(<span class="hljs-string">"GET"</span>);
        request.flush(testSettings);
    });

    it(<span class="hljs-string">"should not initialize settings if get settings.json failed"</span>, <span class="hljs-function"><span class="hljs-params">(done)</span> =&gt;</span> {
        service
            .initializeSettings()
            .<span class="hljs-keyword">then</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                done.fail(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"this was expected to fail"</span>));
            })
            .<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                expect(settingsService.settings).toBeUndefined();
                done();
            });

        const request = httpMock.expectOne(<span class="hljs-string">"assets/settings.json"</span>);
        expect(request.request.method).toBe(<span class="hljs-string">"GET"</span>);
        request.flush(testSettings, {
            status: <span class="hljs-number">500</span>,
            statusText: <span class="hljs-string">"Some Weird Server Error"</span>,
        });
    });
});
</code></pre>
<p>Das war noch nicht weiter kompliziert.
Spannend wird die Frage, wann und wie wir den Service nun nutzen, um die Konfiguration aus der <code>settings.json</code> zu laden.
Die App benÃ¶tigt die Konfiguration, sobald der Browser sie startet.
Leider lÃ¤dt die App die Konfiguration aus dem <code>assets</code>-Verzeichnis per HTTP(S)-Aufruf, somit also asynchron.
Wir brauchen also ein Mittel, um das Laden abzuwarten, bevor die App startet.
GlÃ¼cklicherweise hat Angular dafÃ¼r das Konzept des <code>APP_INITIALIZER</code> eingefÃ¼hrt, das genau das leistet.</p>
<p>Wir passen also das <code>app.module.ts</code> mit dieser Erkenntnis folgendermaÃŸen an, um die Konfiguration zu laden. Tipp: Neu darin sind die Funktion <code>initSettings()</code> vor dem <code>@NgModule()</code>-Decorator und der Provider fÃ¼r das Token <code>APP_INITIALIZER</code>:</p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { HttpClientModule } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/common/http"</span>;
<span class="hljs-keyword">import</span> { BrowserModule } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/platform-browser"</span>;
<span class="hljs-keyword">import</span> { APP_INITIALIZER, NgModule } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;

<span class="hljs-keyword">import</span> { AppRoutingModule } <span class="hljs-keyword">from</span> <span class="hljs-string">"./app-routing.module"</span>;
<span class="hljs-keyword">import</span> { AppComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">"./components/app/app.component"</span>;
<span class="hljs-keyword">import</span> { OneComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">"./components/one/one.component"</span>;
<span class="hljs-keyword">import</span> { TwoComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">"./components/two/two.component"</span>;
<span class="hljs-keyword">import</span> { SettingsInitializerService } <span class="hljs-keyword">from</span> <span class="hljs-string">"./services/settings-initializer.service"</span>;

<span class="hljs-comment">// NEW</span>
<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initSettings</span>(<span class="hljs-params">
    settingsInitializerService: SettingsInitializerService,
</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> settingsInitializerService.initializeSettings();
}

<span class="hljs-meta">@NgModule</span>({
    <span class="hljs-attr">declarations</span>: [AppComponent, OneComponent, TwoComponent],
    <span class="hljs-attr">imports</span>: [BrowserModule, AppRoutingModule, HttpClientModule],
    <span class="hljs-attr">providers</span>: [
        <span class="hljs-comment">// NEW</span>
        {
            <span class="hljs-attr">provide</span>: APP_INITIALIZER,
            <span class="hljs-attr">useFactory</span>: initSettings,
            <span class="hljs-attr">deps</span>: [SettingsInitializerService],
            <span class="hljs-attr">multi</span>: <span class="hljs-literal">true</span>,
        },
    ],
    <span class="hljs-attr">bootstrap</span>: [AppComponent],
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppModule</span> </span>{}
</code></pre>
<p>AnschlieÃŸend kÃ¶nnen wir den <code>SettingsService</code> in der Anwendung verwenden, um die Einstellungen in unseren Komponenten und Services zu nutzen.</p>
<pre><code class="language-typescript"><span class="hljs-keyword">import</span> { Component } <span class="hljs-keyword">from</span> <span class="hljs-string">"@angular/core"</span>;
<span class="hljs-keyword">import</span> { Settings } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../models/settings"</span>;
<span class="hljs-keyword">import</span> { SettingsService } <span class="hljs-keyword">from</span> <span class="hljs-string">"../../services/settings.service"</span>;

<span class="hljs-meta">@Component</span>({
    <span class="hljs-attr">selector</span>: <span class="hljs-string">"app-root"</span>,
    <span class="hljs-attr">templateUrl</span>: <span class="hljs-string">"./app.component.html"</span>,
    <span class="hljs-attr">styleUrls</span>: [<span class="hljs-string">"./app.component.scss"</span>],
})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppComponent</span> </span>{
    title = <span class="hljs-string">"dockerized-app"</span>;
    settings: Settings;

    <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> settingsService: SettingsService</span>)</span> {
        <span class="hljs-built_in">this</span>.settings = settingsService.settings;
    }
}
</code></pre>
<p>Damit haben wir bereits die <em>Development</em>-Umgebung zum Laufen gebracht.
Sie kÃ¶nnen das mittels <code>ng serve</code> oder <code>ng serve --prod</code> leicht nachprÃ¼fen.</p>
<h2 id="umgebung-mit-docker-konfigurieren">Umgebung mit Docker konfigurieren</h2>
<p>Wie erzeugen wir jetzt also pro Umgebung eine passende Datei <code>settings.json</code> je Container?
Ich nutze dafÃ¼r das Tool <code>envsubst</code>.
Dieses liest ein Template, ersetzt darin Umgebungsvariablen und schreibt das Ergebnis in eine neue Datei.</p>
<p>Hier ist das Template in Form der Datei <code>src/assets/settings.json.template</code>:</p>
<pre><code class="language-json">{
    <span class="hljs-attr">"baseUrl"</span>: <span class="hljs-string">"${BASE_URL}"</span>
}
</code></pre>
<p>Jetzt brauchen wir nur noch die Datei <code>docker-compose.yml</code> dahingehend anzupassen, dass <code>envsubst</code> verwendet wird, um zur Laufzeit die passende Datei <code>settings.json</code> fÃ¼r die jeweilige Umgebung zu erstellen:</p>
<pre><code class="language-yaml"><span class="hljs-symbol">version:</span> <span class="hljs-string">"3"</span>
<span class="hljs-symbol">
services:</span>
<span class="hljs-symbol">    web:</span>
<span class="hljs-symbol">        image:</span> dockerized-app
<span class="hljs-symbol">        env_file:</span>
            - ./docker.env
<span class="hljs-symbol">        ports:</span>
            - <span class="hljs-string">"8093:80"</span>
<span class="hljs-symbol">        command:</span> <span class="hljs-meta-keyword">/bin/</span>bash -c <span class="hljs-string">"envsubst '$$BASE_URL' &lt; \
            /usr/share/nginx/html/assets/settings.json.template &gt; \
            /usr/share/nginx/html/assets/settings.json &amp;&amp; exec nginx -g \
            'daemon off;'"</span>
</code></pre>
<p><em>Sie mÃ¼ssen die <code>command</code>-Angabe in <em>eine</em> einzige Zeile packen.
Im obigen Beispiel habe ich die Backslashes lediglich dazu benutzt, die Zeile der Lesbarkeit wegen umzubrechen.</em></p>
<p>Mit dieser Ã„nderung lÃ¤dt <code>docker-compose</code> die Umgebung aus der Datei <code>docker.env</code>, in der Umgebungsvariablen definiert sind.
Die Datei legen Sie bitte mit folgendem Inhalt an:</p>
<pre><code class="language-bash"><span class="hljs-attr">BASE_URL</span>=http://some.<span class="hljs-literal">off</span>icial.server:<span class="hljs-number">444</span>
</code></pre>
<p>Damit haben wir endlich alle Puzzleteile zusammen, um den Docker-Container mit der gewÃ¼nschten Umgebung zu starten: Sie benÃ¶tigen je Umgebung lediglich eine Datei <code>docker.env</code> und darin die jeweils passenden Umgebungsvariablen.
Die Skripte <code>dockerize.sh</code> und <code>redeploy.sh</code> aus dem vorherigen Teil funktionieren Ã¼brigens ohne Ã„nderung weiterhin.</p>
<h2 id="ausblick">Ausblick</h2>
<p>Die Artikelserie besteht aus den folgenden Teilen:</p>
<ol>
<li><a href="https://angular-buch.com/blog/2019-12-docker0-intro">Angular-Apps und Docker: Einleitung</a></li>
<li><a href="https://angular-buch.com/blog/2019-12-docker1-simple-case">Angular-App Ã¼ber Docker bereitstellen</a></li>
<li><a href="https://angular-buch.com/blog/2019-12-docker2-build-once-run-anywhere">Build Once, Run Anywhere oder: Konfiguration Ã¼ber Docker verwalten</a> <strong>(der aktuelle Artikel)</strong></li>
<li><a href="https://angular-buch.com/blog/2019-12-docker3-multi-stage-build">Multi-Stage Builds oder: Immer die Build-Umgebung dabei haben</a></li>
</ol>
<p>Im letzten Teil der Artikelserie zeige ich Ihnen, wie sie die Buildumgebung Ã¼ber die Projektlaufzeit im Griff behalten, auch wenn Sie Ihr System durch neue Versionen der benÃ¶tigten Werkzeuge verÃ¤ndern.</p>
<br>
<hr>

<p><small><strong>Titelbild:</strong> Bild von <a href="https://unsplash.com/@chuttersnap">chuttersnap</a> auf <a href="https://unsplash.com">Unsplash</a>, bearbeitet</small></p>
</p><!----><!----><a routerlink="/blog" ripple-radius="" class="btn btn-sm btn-primary mt-4" href="/blog"><i class="fa fa-backward mr-2"></i> ZurÃ¼ck</a><hr> Suggestions? Feedback? Bugs? Please <a target="_blank" class="content" href="https://github.com/angular-buch/website-articles/blob/gh-pages/blog/2019-12-docker2-build-once-run-anywhere/README.md"><i class="fa fa-github mr-1" style="font-size: 1.6rem; position: relative; bottom: -3px;"></i>fork/edit this page on Github</a>. </div></div></div></div></div><div class="row" style="margin-top: -20px;"><div class="col-12"><div class="index__item index__item--list"><div class="row align-items-top"><div class="col-12 col-sm-3 col-md-2 text-center"><img alt="" class="blog__portrait img-fluid rounded-circle lazyload" data-src="//www.gravatar.com/avatar/4d89f498c1a638682a07b73648c0d3b5?size=200&amp;rating=pg&amp;d=mm" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><span class="blog__author">Michael Kaaden <br><a target="_blank" class="twitter" href="https://twitter.com/angular_schule"> @angular_schule</a> &nbsp; <!----></span></div><div class="col-12 col-sm-9 col-md-10 col-lg-10"><h2>Ãœber den Autor</h2><p class="content"> Michael Kaaden ist als Software-Architekt und Manager fÃ¼r ein mittelstÃ¤ndisches Unternehmen in NÃ¼rnberg tÃ¤tig. Dort ist er fÃ¼r die technische Seite einer Cloud-Produktline verantwortlich. In dieser Eigenschaft kÃ¼mmert er sich trotz seiner grundsÃ¤tzlichen AffinitÃ¤t zu Angular nicht nur um Frontends, sondern neben der Gesamtarchitektur unter anderem auch um APIs, Backends, Datenbanken sowie Software-Entwicklungs- und Build-Prozesse. Wenn er in seiner Freizeit nicht gerade mit seiner Familie unterwegs ist, Full-Stack Developer spielt oder seine Nase in neue Technologien steckt, versucht er, seinen Laufstil zu verbessern und endlich den fÃ¼r ihn perfekten Fotoapparat zu finden. </p></div></div></div></div></div><!----></div><!----><!----></div></section><app-json-ld><script type="application/ld+json">{
  "url": "https://angular.schule/blog/2019-12-docker2-build-once-run-anywhere",
  "headline": "[Docker Serie 3/4] Build Once, Run Anywhere oder: Konfiguration Ã¼ber Docker verwalten",
  "description": "Build Once, Run Anywhere:\nWie Sie ein einziges Image zur Laufzeit an beliebige Umgebungen anpassen.\nBleiben Sie auch ohne Code-Ã„nderung flexibel!\nDies ist der 3. Teil unserer vierteiligen Artikelserie zu Angular und Docker.",
  "datePublished": "2019-12-16",
  "dateModified": "2019-12-16",
  "publisher": {
    "name": "Angular-Buch",
    "url": "https://angular-buch.com",
    "@type": "Organization",
    "logo": {
      "@type": "ImageObject",
      "url": "https://angular-buch.com/assets/img/brand_export.png"
    }
  },
  "image": "https://website-articles.angular-buch.com/blog/2019-12-docker2-build-once-run-anywhere/header2.jpg",
  "thumbnailUrl": "https://website-articles.angular-buch.com/blog/2019-12-docker2-build-once-run-anywhere/header2.jpg",
  "author": {
    "@type": "Person",
    "name": "Michael Kaaden",
    "email": "blog@kaaden.net"
  },
  "keywords": [
    "Docker",
    "Settings",
    "Angular",
    "APP_INITIALIZER"
  ],
  "mainEntityOfPage": "http://schema.org/WebPage",
  "@type": "Article",
  "@context": "http://schema.org"
}</script></app-json-ld></app-blog-details><!----><footer><div class="container"><div class="row align-items-center"><div class="col-sm-9"><div class="links"><app-link><!----><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/"><!----> Home </a><!----><!----></app-link>|<!----><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/impressum"><!----> Impressum </a><!----><!----><!----></app-link>|<!----><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/datenschutz"><!----> DatenschutzerklÃ¤rung </a><!----><!----><!----></app-link>|<!----><app-link><!----><a class="links__item links__twitter" href="https://twitter.com/angular_buch" rel="nofollow"><!----> Twitter </a><!----><!----><!----><!----></app-link><!----><!----></div></div><div class="col-sm-3 text-right"></div></div></div></footer></main><app-json-ld><script type="application/ld+json"></script></app-json-ld></app-root>
<script src="polyfills-LZBJRJJE.js" type="module"></script><script src="main-3GBHPJS6.js" type="module"></script>

</body></html>