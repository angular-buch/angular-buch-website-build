<!DOCTYPE html><html><head lang="de" prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#"><meta name="generator" content="Scully 0.0.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <title>Angular-Buch â†’ Mach aus deiner Angular-App eine PWA</title>
  

  

  <meta property="book:author" content="https://www.facebook.com/ferdinand.malcher">
  <meta property="book:author" content="https://www.facebook.com/johannes.hoppe">
  <meta property="book:author" content="https://www.facebook.com/dannykoppenhagen">

  <meta property="book:isbn" content="9783864909467">
  <meta property="book:release_date" content="2023-02-28">
  <meta property="book:tag" content="Angular">
  <meta property="book:tag" content="Webentwicklung">
  <meta property="book:tag" content="AngularJS">
  <meta property="book:tag" content="TypeScript">
  <meta property="book:tag" content="JavaScript">
  <meta property="book:tag" content="HTML5">
  <meta property="book:tag" content="CSS">
  <meta property="book:tag" content="RxJS">
  <meta property="book:tag" content="Redux">
  <meta property="book:tag" content="NgRx">

  <base href="/">
<style>@font-face{font-family:Roboto;src:url(Roboto-Thin.3025beb410a67d09.eot);src:local("Roboto Thin"),local("Roboto-Thin"),url(Roboto-Thin.3025beb410a67d09.eot?#iefix) format("embedded-opentype"),url(Roboto-Thin.a529f43f8b43a41b.woff2) format("woff2"),url(Roboto-Thin.0cfb6189823d7275.woff) format("woff"),url(Roboto-Thin.94d67324d95f59e5.ttf) format("truetype"),url(Roboto-Thin.761d85cbad1d4c0a.svg#Roboto) format("svg");font-weight:100;font-style:normal}@font-face{font-family:Roboto;src:url(Roboto-ThinItalic.3c0494ed5066eddf.eot);src:local("Roboto ThinItalic"),local("Roboto-ThinItalic"),url(Roboto-ThinItalic.3c0494ed5066eddf.eot?#iefix) format("embedded-opentype"),url(Roboto-ThinItalic.7d4425d4f9dfbd4d.woff2) format("woff2"),url(Roboto-ThinItalic.72445820525e265f.woff) format("woff"),url(Roboto-ThinItalic.72ab0263ccb0dc3f.ttf) format("truetype"),url(Roboto-ThinItalic.7d3f4f17bca5edb0.svg#Roboto) format("svg");font-weight:100;font-style:italic}@font-face{font-family:Roboto;src:url(Roboto-Light.9cff5f27f6ad3d59.eot);src:local("Roboto Light"),local("Roboto-Light"),url(Roboto-Light.9cff5f27f6ad3d59.eot?#iefix) format("embedded-opentype"),url(Roboto-Light.7117d83fbb0aa28a.woff2) format("woff2"),url(Roboto-Light.2188ea3f3f8ab51a.woff) format("woff"),url(Roboto-Light.5605865fb101be1a.ttf) format("truetype"),url(Roboto-Light.775a1d8f32378e56.svg#Roboto) format("svg");font-weight:300;font-style:normal}@font-face{font-family:Roboto;src:url(Roboto-LightItalic.4a75ae9969c094a3.eot);src:local("Roboto LightItalic"),local("Roboto-LightItalic"),url(Roboto-LightItalic.4a75ae9969c094a3.eot?#iefix) format("embedded-opentype"),url(Roboto-LightItalic.9669ba38989190d7.woff2) format("woff2"),url(Roboto-LightItalic.ead2698c38e2d858.woff) format("woff"),url(Roboto-LightItalic.ccdc52ada30d970f.ttf) format("truetype"),url(Roboto-LightItalic.293a6c412ebb5682.svg#Roboto) format("svg");font-weight:300;font-style:italic}@font-face{font-family:Roboto;src:url(Roboto-Regular.b21a0eefbec4f57f.eot);src:local("Roboto Regular"),local("Roboto-Regular"),url(Roboto-Regular.b21a0eefbec4f57f.eot?#iefix) format("embedded-opentype"),url(Roboto-Regular.e64b7e5db276537f.woff2) format("woff2"),url(Roboto-Regular.2313f68c10458709.woff) format("woff"),url(Roboto-Regular.b796ce65a81adc41.ttf) format("truetype"),url(Roboto-Regular.18c20975d2f2578c.svg#Roboto) format("svg");font-weight:400;font-style:normal}@font-face{font-family:Roboto;src:url(Roboto-RegularItalic.e6e0d5b40d74c833.eot);src:local("Roboto RegularItalic"),local("Roboto-RegularItalic"),url(Roboto-RegularItalic.e6e0d5b40d74c833.eot?#iefix) format("embedded-opentype"),url(Roboto-RegularItalic.d448549043fc24e3.woff2) format("woff2"),url(Roboto-RegularItalic.6c93c3855305929c.woff) format("woff"),url(Roboto-RegularItalic.c6469a92f47f72b9.ttf) format("truetype"),url(Roboto-RegularItalic.f83754e74962d444.svg#Roboto) format("svg");font-weight:400;font-style:italic}@font-face{font-family:Roboto;src:url(Roboto-Medium.9a9c9421bcdef79c.eot);src:local("Roboto Medium"),local("Roboto-Medium"),url(Roboto-Medium.9a9c9421bcdef79c.eot?#iefix) format("embedded-opentype"),url(Roboto-Medium.31c42d9dbee477e5.woff2) format("woff2"),url(Roboto-Medium.769ea541b3eef14d.woff) format("woff"),url(Roboto-Medium.03501557d620ee6b.ttf) format("truetype"),url(Roboto-Medium.8a59a67632175b0b.svg#Roboto) format("svg");font-weight:500;font-style:normal}@font-face{font-family:Roboto;src:url(Roboto-MediumItalic.eda8bf9be9c607a9.eot);src:local("Roboto MediumItalic"),local("Roboto-MediumItalic"),url(Roboto-MediumItalic.eda8bf9be9c607a9.eot?#iefix) format("embedded-opentype"),url(Roboto-MediumItalic.2b1343b2d0b09b92.woff2) format("woff2"),url(Roboto-MediumItalic.226e2a5000081685.woff) format("woff"),url(Roboto-MediumItalic.ce75fe30feef2519.ttf) format("truetype"),url(Roboto-MediumItalic.b51310a741b5d779.svg#Roboto) format("svg");font-weight:500;font-style:italic}@font-face{font-family:Roboto;src:url(Roboto-Bold.0d2870f5e1759c7a.eot);src:local("Roboto Bold"),local("Roboto-Bold"),url(Roboto-Bold.0d2870f5e1759c7a.eot?#iefix) format("embedded-opentype"),url(Roboto-Bold.6980f6575e8c2cbd.woff2) format("woff2"),url(Roboto-Bold.313d5de65a92aae6.woff) format("woff"),url(Roboto-Bold.ed694f411e0b3a82.ttf) format("truetype"),url(Roboto-Bold.a5d983d959171823.svg#Roboto) format("svg");font-weight:700;font-style:normal}@font-face{font-family:Roboto;src:url(Roboto-BoldItalic.24d4fc9379818f4d.eot);src:local("Roboto BoldItalic"),local("Roboto-BoldItalic"),url(Roboto-BoldItalic.24d4fc9379818f4d.eot?#iefix) format("embedded-opentype"),url(Roboto-BoldItalic.986a9dba772d1a7a.woff2) format("woff2"),url(Roboto-BoldItalic.d0b1358f293918c7.woff) format("woff"),url(Roboto-BoldItalic.e3188bd071401a05.ttf) format("truetype"),url(Roboto-BoldItalic.98e79b0548caa896.svg#Roboto) format("svg");font-weight:700;font-style:italic}@font-face{font-family:Roboto;src:url(Roboto-Black.2a430d2577a70997.eot);src:local("Roboto Black"),local("Roboto-Black"),url(Roboto-Black.2a430d2577a70997.eot?#iefix) format("embedded-opentype"),url(Roboto-Black.710dab121b2a7bc2.woff2) format("woff2"),url(Roboto-Black.06740b883cfa8a2e.woff) format("woff"),url(Roboto-Black.41a719429c37346e.ttf) format("truetype"),url(Roboto-Black.711c7acb0aa346bb.svg#Roboto) format("svg");font-weight:900;font-style:normal}@font-face{font-family:Roboto;src:url(Roboto-BlackItalic.65db2fd69db01cd5.eot);src:local("Roboto BlackItalic"),local("Roboto-BlackItalic"),url(Roboto-BlackItalic.65db2fd69db01cd5.eot?#iefix) format("embedded-opentype"),url(Roboto-BlackItalic.f4307ac32c9ad43b.woff2) format("woff2"),url(Roboto-BlackItalic.fc1832915de70c44.woff) format("woff"),url(Roboto-BlackItalic.ba2ec768f43dbc84.ttf) format("truetype"),url(Roboto-BlackItalic.26186c8936090567.svg#Roboto) format("svg");font-weight:900;font-style:italic}@charset "UTF-8";:root{--blue:#007bff;--indigo:#6610f2;--purple:#6f42c1;--pink:#e83e8c;--red:#dc3545;--orange:#fd7e14;--yellow:#ffc107;--green:#28a745;--teal:#20c997;--cyan:#17a2b8;--white:#fff;--gray:#6c757d;--gray-dark:#343a40;--primary:#007bff;--secondary:#6c757d;--success:#28a745;--info:#17a2b8;--warning:#ffc107;--danger:#dc3545;--light:#f8f9fa;--dark:#343a40;--breakpoint-xs:0;--breakpoint-sm:576px;--breakpoint-md:768px;--breakpoint-lg:992px;--breakpoint-xl:1200px;--font-family-sans-serif:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";--font-family-monospace:SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}*,*:before,*:after{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,Liberation Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}@media print{*,*:before,*:after{text-shadow:none!important;box-shadow:none!important}img{page-break-inside:avoid}@page{size:a3}body{min-width:992px!important}}body{color:#1e1e1e;font-family:"Roboto","Helvetica Neue",Helvetica,Arial sans-serif;font-size:16px;line-height:1.35em;font-weight:400;background:#F8F8F8}html{overflow-y:scroll}</style><link rel="stylesheet" href="styles.a5ccd8a47bf46083.css" media="all" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles.a5ccd8a47bf46083.css"></noscript><meta property="og:title" content="Angular-Buch â†’ Mach aus deiner Angular-App eine PWA"><meta name="twitter:title" content="Angular-Buch â†’ Mach aus deiner Angular-App eine PWA"><meta name="description" content="ðŸ“™ Immer hÃ¤ufiger stÃ¶ÃŸt man im Webumfeld auf den Begriff der Progessive Web App â€“ kurz: PWA. Doch was genau steckt dahinter und welche Vorteile hat eine PWA gegenÃ¼ber einer herkÃ¶mmlichen Webanwendung oder einer App?
Als Progressive Web App bezeichnen wir eine Webanwendung, die beim Aufruf einer Website als App auf einem lokalen GerÃ¤t installiert werden kann â€“ zum Beispiel auf dem Telefon oder Tablet.
Die PWA lÃ¤sst sich wie jede andere App nutzen, inklusive Push-Benachrichtigungen!"><meta property="og:description" content="ðŸ“™ Immer hÃ¤ufiger stÃ¶ÃŸt man im Webumfeld auf den Begriff der Progessive Web App â€“ kurz: PWA. Doch was genau steckt dahinter und welche Vorteile hat eine PWA gegenÃ¼ber einer herkÃ¶mmlichen Webanwendung oder einer App?
Als Progressive Web App bezeichnen wir eine Webanwendung, die beim Aufruf einer Website als App auf einem lokalen GerÃ¤t installiert werden kann â€“ zum Beispiel auf dem Telefon oder Tablet.
Die PWA lÃ¤sst sich wie jede andere App nutzen, inklusive Push-Benachrichtigungen!"><meta name="twitter:description" content="ðŸ“™ Immer hÃ¤ufiger stÃ¶ÃŸt man im Webumfeld auf den Begriff der Progessive Web App â€“ kurz: PWA. Doch was genau steckt dahinter und welche Vorteile hat eine PWA gegenÃ¼ber einer herkÃ¶mmlichen Webanwendung oder einer App?
Als Progressive Web App bezeichnen wir eine Webanwendung, die beim Aufruf einer Website als App auf einem lokalen GerÃ¤t installiert werden kann â€“ zum Beispiel auf dem Telefon oder Tablet.
Die PWA lÃ¤sst sich wie jede andere App nutzen, inklusive Push-Benachrichtigungen!"><meta name="twitter:site" content="@angular_buch"><meta property="og:locale" content="de"><meta property="og:type" content="website"><meta property="og:url" content="https://angular-buch.com/blog/2019-07-progressive-web-app"><style>.width-6{width:6.5rem}.width-8{width:8rem}.linkImage{margin-right:3px;margin-top:-3px}
</style><style>.content img{max-width:100%}.details-page-autor{margin-top:-110px}.details-thumbnail{margin-bottom:-18px}.details-thumbnail .details-thumbnail-inner{border-bottom:23px solid #dfdede;max-height:300px;overflow:hidden;background-color:#fff;border-radius:4px;display:flex;justify-content:center}.details-thumbnail .details-thumbnail-inner .darken-overlay{display:block;position:absolute;height:300px;width:100%;padding-left:15px;padding-right:15px;padding-bottom:23px}.details-thumbnail .details-thumbnail-inner .darken-overlay div{display:block;position:relative;width:100%;height:100%;background-color:#0003;border-radius:4px 4px 0 0/4px 4px 0px 0px}.details-thumbnail img{width:100%;align-self:center}.video-container{position:relative;padding-bottom:56.25%;padding-top:0;height:0;overflow:hidden;margin-top:2rem;margin-bottom:2rem}.video-container iframe,.video-container object,.video-container embed{position:absolute;top:0;left:0;width:100%;height:100%}
</style><style>a[_ngcontent-rdw-c14]:link, a[_ngcontent-rdw-c14]:visited{text-decoration:underline}a[_ngcontent-rdw-c14]:hover, a[_ngcontent-rdw-c14]:active{text-decoration:none}</style><meta property="og:image" content="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwaheader.jpg"><meta name="twitter:image" content="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwaheader.jpg"><meta name="twitter:card" content="summary_large_image"><script>window['ScullyIO']='generated';</script></head>
<body scully-version="0.0.0">
  <app-root ng-version="15.1.0"><header><div class="nav__overlay"></div><div class="container"><div class="row no-gutters align-items-center"><div class="col-6 col-md-2"><a routerlink="/"><img src="assets/img/brand.svg" alt="" class="img-fluid" style="height: 40px;"></a></div><div class="col-6 col-md-10"><nav><ul><li><app-link><!----><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/"><!----> Buch </a><!----><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/blog" class="nav__current" aria-current="page"><!----> Blog </a><!----><!----><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/material"><!----> Begleitmaterial </a><!----><!----><!----><!----></app-link></li><li><app-link><!----><a class="order" href="//angular.schule/"><img alt="" class="linkImage ls-is-cached lazyloaded" data-src="assets/img/symbol-calendar.svg" src="assets/img/symbol-calendar.svg"><!----> Angular-Schulungen </a><!----><!----><!----><!----><!----></app-link></li><li><app-link><!----><a class="order" href="https://amzn.eu/d/8fgTIWL"><img alt="" class="linkImage ls-is-cached lazyloaded" data-src="assets/img/symbol-basket.svg" src="assets/img/symbol-basket.svg"><!----> Jetzt vorbestellen </a><!----><!----><!----><!----><!----></app-link></li><!----></ul></nav><a href="/" class="nav__toggle"><img src="assets/img/symbol-menu.svg" alt=""></a></div></div></div></header><main><router-outlet></router-outlet><app-blog-details><app-hero-header headline="Blog" headlinelink="/blog"><section class="hero hero--smallest"><div class="hero__lines hero__lines--smallest"><div class="container"><div class="row justify-content-between"><div class="col-md-6 col-xs-12"><h1 class="headline__page headline__page--blank headline__page--space-bottom"><a style="color: white;">Blog</a><!----><!----></h1></div><div class="col-5 d-none d-md-block text-center"><img src="assets/img/angular.png" alt="" class="hero__angular--smallest"></div></div></div></div></section><a name="content" id="content"></a></app-hero-header><section class="index index--list blog"><div class="index__stripe index__stripe--list"><!----><div class="container"><a name="post" id="post"></a><div class="row details-thumbnail"><div class="col-12"><div class="details-thumbnail-inner"><img alt="" class="img-fluid rounded" src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwaheader.jpg"><!----></div></div><!----></div><div class="row"><div class="col-12"><div class="index__item index__item--list"><div class="row align-items-top"><div class="col-12 col-sm-3 col-md-2 text-center details-page-autor"><img alt="" class="blog__portrait img-fluid rounded-circle" src="//www.gravatar.com/avatar/be2ebed82ed399218b89e90abd5bdcc2?size=200&amp;rating=pg&amp;d=mm"><span class="blog__author">Danny Koppenhagen <br><a target="_blank" class="twitter" href="https://twitter.com/d_koppenhagen"> @d_koppenhagen</a> &nbsp; <!----><!----></span></div><div class="col-12 col-sm-9 col-md-10 col-lg-10"><h1 class="blog__headline">Mach aus deiner Angular-App eine PWA</h1><p class="blog__date">24.07.2019</p><p class="content markdown-body"><p>Immer hÃ¤ufiger stÃ¶ÃŸt man im Webumfeld auf den Begriff der Progessive Web App â€“ kurz: PWA. Doch was genau steckt dahinter und welche Vorteile hat eine PWA gegenÃ¼ber einer herkÃ¶mmlichen Webanwendung oder einer App?
Als <em>Progressive Web App</em> bezeichnen wir eine Webanwendung, die beim Aufruf einer Website als App auf einem lokalen GerÃ¤t installiert werden kann â€“ zum Beispiel auf dem Telefon oder Tablet.
Die PWA lÃ¤sst sich wie jede andere App nutzen, inklusive Push-Benachrichtigungen!</p>
<hr>

<p>Inhalt:</p>
<ul>
<li><a href="/blog/2019-07-progressive-web-app#webanwendung-vs-pwa-vs-app">Webanwendung vs. PWA vs. App</a></li>
<li><a href="/blog/2019-07-progressive-web-app#add-to-homescreen">Add to Homescreen</a></li>
<li><a href="/blog/2019-07-progressive-web-app#offline-funktionalit-t">Offline-FunktionalitÃ¤t</a></li>
<li><a href="/blog/2019-07-progressive-web-app#push-notifications">Push Notifications</a></li>
<li><a href="/blog/2019-07-progressive-web-app#zusammenfassung">Zusammenfassung</a></li>
</ul>
<h2 id="webanwendung-vs-pwa-vs-app">Webanwendung vs. PWA vs. App</h2>
<p>Wir wollen zunÃ¤chst den Begriff der PWA etwas konkreter einordnen. Dazu schauen wir uns den Unterschied einer PWA im Vergleich zu einer herkÃ¶mmlichen Webanwendung und einer App an.
Mithilfe einer Webanwendung kann ein Nutzer Ã¼ber eine URL im Browser Informationen abrufen und verarbeiten. Eine App erfÃ¼llt einen Ã¤hnlichen Zweck, wird allerdings auf einem GerÃ¤t lokal installiert und benÃ¶tigt in der Regel keinen Browser zur Informationsverarbeitung. Weiterhin kann eine App prinzipiell auch offline genutzt werden, und sie hat oft Zugriff auf native Funktionen des GerÃ¤ts: Push Notifications und Zugriff auf das Dateisystem sowie Kamera und Sensorik. Eine PWA stellt nun eine Art Mix von beidem dar: Es handelt sich grundlegend auch um eine Webanwendung, sie wird allerdings durch den Nutzer heruntergeladen und auf dem lokalen GerÃ¤t gespeichert. Weiterhin sorgt eine PWA dafÃ¼r, dass die wichtigsten Daten im Client gecacht werden. Somit bleiben Informationen, die die Anwendung liefert, stets abrufbar â€“ auch wenn ggf. keine durchgÃ¤ngige Internetverbindung vorhanden ist. AuÃŸerdem kann eine PWA auch Push Notifications erhalten und anzeigen.</p>
<p>Die drei wichtigsten Charakteristiken einer PWA sind also folgende:</p>
<ul>
<li>"Add to Homescreen"-FunktionalitÃ¤t</li>
<li>Offline-FÃ¤higkeit</li>
<li>Push Notifications</li>
</ul>
<blockquote>
<p>Ãœbrigens: Sie kÃ¶nnen eine PWA auch ganz einfach als App in Form eine <em>Trusted Web Activity</em> im Android Store bereitstellen.
Mehr dazu erfahren Sie in unserem Artikel <a href="/blog/2020-11-twa"><em>Trusted Web Activitys (TWA) mit Angular</em></a>.</p>
</blockquote>
<h3 id="service-worker">Service Worker</h3>
<p>Als Grundvoraussetzung, um eine PWA offlinefÃ¤hig zu machen und Push-Benachrichtigungen zu versenden, werden die sogenannten <em>Service Worker</em> benÃ¶tigt. Service Worker sind gewissermaÃŸen kleine Helfer des Browsers, die bestimmte Aufgaben im Hintergrund Ã¼bernehmen.
Hierzu zÃ¤hlen das Speichern und Abrufen der Daten auf einem EndgerÃ¤t. Service Worker prÃ¼fen beispielsweise, ob eine Netzwerkverbindung besteht, und senden  â€“ je nach Konfiguration â€“ Daten aus dem Cache an die Anwendung, oder versuchen, die Daten online abzurufen.
Eine weitere Aufgabe ist das Empfangen von Push-Benachrichtigungen vom Server.</p>
<h3 id="eine-bestehende-angular-anwendung-in-eine-pwa-verwandeln">Eine bestehende Angular-Anwendung in eine PWA verwandeln</h3>
<p>Schauen wir uns das Ganze an einem Beispiel an.
Wie wollen das <a href="https://book-monkey3.angular-buch.com">Beispielprojekt BookMonkey</a> aus dem Angular-Buch in eine PWA verwandeln. Somit kÃ¶nnen Nutzer die App auf ihrem GerÃ¤t installieren und erhalten stets Buchdaten, auch wenn gerade keine NetzwerkkonnektivitÃ¤t vorhanden ist. ZunÃ¤chst klonen wir uns hierfÃ¼r die bestehende Webanwendung in ein lokales Repository:</p>
<pre><code class="language-bash"><span class="hljs-attribute">git</span> clone git@github.com:book-monkey<span class="hljs-number">3</span>/iteration-<span class="hljs-number">7</span>-i<span class="hljs-number">18</span>n.git BookMonkey-PWA
<span class="hljs-attribute">cd</span> BookMonkey-PWA
</code></pre>
<p>Als NÃ¤chstes fÃ¼gen wir das Paket <code>@angular/pwa</code> mithilfe von <code>ng add</code> zum Projekt hinzu.
Die dahinterliegenden Schematics nehmen uns bereits einen GroÃŸteil der Arbeit zum Erzeugen der PWA ab:</p>
<ul>
<li>HinzufÃ¼gen des Pakets <code>@angular/service-worker</code> zu unserem Projekt</li>
<li>Aktivieren des Build Support fÃ¼r Service Worker in der Angular CLI</li>
<li>Importieren und Registrieren des <code>ServiceWorkerModule</code> im <code>AppModule</code></li>
<li>Update der Datei <code>index.html</code> mit einem Link zum Web App Manifest (<code>manifest.json</code>) sowie HinzufÃ¼gen relevanter Meta-Tags</li>
<li>Erzeugen und Verlinken von Icon-Dateien</li>
<li>Erzeugen der Konfigurationsdatei <code>ngsw-config.json</code> fÃ¼r den Service Worker</li>
</ul>
<pre><code class="language-bash">ng <span class="hljs-keyword">add</span> <span class="hljs-variable">@angular</span><span class="hljs-operator">/</span>pwa <span class="hljs-comment">--project BookMonkey</span>
</code></pre>
<p>Soweit so gut â€“ das wichtigste ist bereits erledigt. Wir kÃ¶nnen jetzt schon unsere Anwendung in Form einer PWA erzeugen und nutzen.
Wichtig ist, dass die Anwendung immer im Produktivmodus gebaut wird, denn der Service Worker ist im Entwicklungsmodus nicht aktiv.</p>
<pre><code class="language-bash">ng build <span class="hljs-comment">--prod</span>
</code></pre>
<p>Nach dem Build der Anwendung wollen wir uns das Ergebnis im Browser ansehen. DafÃ¼r kÃ¶nnen wir das Paket <code>angular-http-server</code> nutzen, das einen einfachen Webserver bereitstellt.</p>
<blockquote>
<p>Der <code>angular-http-server</code> leitet im Gegensatz zum <code>http-server</code> alle Anfragen zu nicht existierenden Verzeichnissen oder Dateien an die Datei <code>index.html</code> weiter.
Dies ist notwendig, da das Routing durch Angular und nicht durch den Webserver durchgefÃ¼hrt wird.</p>
</blockquote>
<pre><code class="language-bash">npm i angular-<span class="hljs-keyword">http</span>-server <span class="hljs-comment">--save-dev</span>
npx angular-<span class="hljs-keyword">http</span>-server <span class="hljs-comment">--path=dist/BookMonkey</span>
</code></pre>
<p>Um nun zu testen, ob wir tatsÃ¤chlich eine PWA erhalten haben, rufen wir am besten die Google Chrome Developer Tools auf. Dort kÃ¶nnen wir im Tab <em>Network</em> die Checkbox <em>Offline</em> setzen.
AnschlieÃŸend laden wir die Seite neu.
Wir sehen, dass trotz des Offline-Modus die Startseite unserer App angezeigt wird, da der Service Worker ein Caching erwirkt hat.
Navigieren wir allerdings zur Buchliste, so kÃ¶nnen keine BÃ¼cher angezeigt werden.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/bm-pwa-offline.png" alt="Screenshot BookMonkey PWA, Offline-Modus in den Google Chrome Developer Tools aktivieren"></p>
<blockquote>
<p>Achtung: Die PWA verwendet Service Worker. Diese kÃ¶nnen ausschlieÃŸlich Ã¼ber gesicherte Verbindungen mit HTTPS oder Ã¼ber eine <code>localhost</code>-Verbindung genutzt werden. Rufen Sie die App, die mittels <code>angular-http-server</code> ohne SSL ausgeliefert wird, also Ã¼ber ein anderes GerÃ¤t auf, so werden die Service Worker nicht wie gewÃ¼nscht funktionieren.</p>
</blockquote>
<h2 id="add-to-homescreen">Add to Homescreen</h2>
<p>Prinzipiell kann jede Website unter Android oder iOS zum Homescreen hinzugefÃ¼gt werden.
Sie erhÃ¤lt dann ein eigenes App-Icon erhÃ¤lt und sieht zunÃ¤chst schon wie eine native App aus.
Unter iOS wird hierfÃ¼r der Safari-Browser benÃ¶tigt.
Im Safari kann Ã¼ber den Button <em>Teilen</em> (kleines Rechteck mit einem Pfeil nach oben) ein MenÃ¼ geÃ¶ffnet werden, in dem die Auswahl "Zum Home-Bildschirm" zu finden ist.
Nach BestÃ¤tigung des Dialogfelds wird eine VerknÃ¼fung auf dem Homescreen angelegt.
Aber: Haben wir hier noch keine speziellen Icons hinterlegt, wird ggf. nur eine Miniatur der Website als Icon angezeigt.</p>
<h3 id="das-web-app-manifest-anpassen-manifestjson">Das Web App Manifest anpassen (<code>manifest.json</code>)</h3>
<p>Das Web App Manifest ist eine JSON-Datei, die dem Browser mitteilt, wie sich die Anwendung verhalten soll, wenn Sie installiert wird. Hier wird beispielsweise eine Hintergrundfarbe fÃ¼r die MenÃ¼leiste auf den nativen EndgerÃ¤ten hinterlegt, und es werden die Pfade zu hinterlegten Icons angegeben.</p>
<p>Wir wollen die Standard-Datei, die von den PWA Schematics generiert wurde, noch etwas anpassen. Um dies nicht hÃ¤ndisch zu tun, verwenden wir am besten einen Generator wie den <a href="https://app-manifest.firebaseapp.com/">Web App Manifest Generator</a>.
Hierbei sollten wir bei der Einstellung <em>Display Mode</em> die Auswahl <em>Standalone</em> nutzen, da wir eine eigenstÃ¤ndige App erhalten wollen, die nicht als Browser erkennbar ist.
Wollen wir das Standard-Icon Ã¤ndern, laden wir hier einfach ein Bild hoch und lassen die zugehÃ¶rigen Bilder erzeugen. Nach dem Entpacken der ZIP-Datei speichern wir die Icons in unserem Projekt unter <code>src/assets/icons</code> ab. AnschlieÃŸend sollten wir noch einmal die Pfade in der Datei <code>manifest.json</code> prÃ¼fen.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/web-app-manifest-generator.png" alt="Screenshot Web App Manifest Generator"></p>
<h3 id="anpassungen-fÃ¼r-ios-indexhtml">Anpassungen fÃ¼r iOS (<code>index.html</code>)</h3>
<p>Wollen wir unsere PWA unter iOS installieren, sind noch einige Anpassungen an der Datei <code>index.html</code> notwendig.
iOS-GerÃ¤te benÃ¶tigen spezielle <code>meta</code>- und <code>link</code>-Tags zur Identifizierung der zugehÃ¶rigen Icons, denn sie extrahieren diese Informationen nicht aus dem Web-Manifest.</p>
<p>Um das Icon fÃ¼r den Homescreen zu definieren, mÃ¼ssen die folgenden Zeilen in die Datei <code>index.html</code> eingefÃ¼gt werden:</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  ...
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-icon"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/icons/icon-512x512.png"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-icon"</span> <span class="hljs-attr">sizes</span>=<span class="hljs-string">"152x152"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/icons/icon-152x152.png"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</code></pre>
<p>Wir geben den entsprechenden Pfad zum genutzten Icon an. Ãœber das Attribut <code>sizes</code> kÃ¶nnen wir Icons mit bestimmten GrÃ¶ÃŸen hinterlegen. Weitere gÃ¤ngige GrÃ¶ÃŸen fÃ¼r iOS sind z. B. <code>180x180</code> und <code>167x167</code>.</p>
<p>Weiterhin kÃ¶nnen wir Ã¼ber die <code>link</code>-Tags fÃ¼r iOS ein Splashscreen-Bild hinterlegen. Dieses wird angezeigt, sobald wir die App vom Homescreen aus starten.
Auch hierfÃ¼r existiert ein Generator, der uns die Bilder in den entsprechenden GrÃ¶ÃŸen erzeugt und und die generierten <code>link</code>-Tags anzeigt: <a href="https://appsco.pe/developer/splash-screens/">iOS Splash Screen Generator</a>.</p>
<p>AnschlieÃŸend fÃ¼gen wir die Tags ebenfalls in die <code>index.html</code> ein. Wir mÃ¼ssen an dieser Stelle noch den Pfad zu den Bildern so anpassen, dass er korrekt auf die tatsÃ¤chlichen Dateien zeigt.
Die erste Zeile teilt iOS-GerÃ¤ten mit, dass die Webanwendung als App genutzt werden kann. Nur wenn diese Zeile in der <code>index.html</code> angegeben wurde, liest das iOS-GerÃ¤t den <code>link</code>-Tag mit der Angabe zum Splashscreen aus.</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ... --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"apple-mobile-web-app-capable"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"yes"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ... --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/splashscreens/iphone5_splash.png"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2)"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-startup-image"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/splashscreens/iphone6_splash.png"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2)"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-startup-image"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/splashscreens/iphoneplus_splash.png"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(device-width: 621px) and (device-height: 1104px) and (-webkit-device-pixel-ratio: 3)"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-startup-image"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/splashscreens/iphonex_splash.png"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3)"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-startup-image"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/splashscreens/iphonexr_splash.png"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2)"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-startup-image"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/splashscreens/iphonexsmax_splash.png"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3)"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-startup-image"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/splashscreens/ipad_splash.png"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2)"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-startup-image"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/splashscreens/ipadpro1_splash.png"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2)"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-startup-image"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/splashscreens/ipadpro3_splash.png"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2)"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-startup-image"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"assets/splashscreens/ipadpro2_splash.png"</span> <span class="hljs-attr">media</span>=<span class="hljs-string">"(device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2)"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"apple-touch-startup-image"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</code></pre>
<p>Als Letztes haben wir noch die MÃ¶glichkeit, die Statusbar der App hinsichtlich ihrer Farbe anzupassen. Dazu fÃ¼hren wir das folgende Metatag zur <code>index.html</code> hinzu.</p>
<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ... --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"apple-mobile-web-app-status-bar-style"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"black"</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</code></pre>
<p>Wir kÃ¶nnen als Wert fÃ¼r <code>content</code> zwischen den folgenden Einstellungen wÃ¤hlen:</p>
<table>
<thead>
<tr>
<th></th>
<th>Text- und Iconfarbe</th>
<th>Hintergrundfarbe</th>
</tr>
</thead>
<tbody><tr>
<td><code>default</code></td>
<td>Schwarz</td>
<td>WeiÃŸ</td>
</tr>
<tr>
<td><code>white</code></td>
<td>Schwarz</td>
<td>WeiÃŸ</td>
</tr>
<tr>
<td><code>black</code></td>
<td>WeiÃŸ</td>
<td>Schwarz</td>
</tr>
<tr>
<td><code>black-translucent</code></td>
<td>WeiÃŸ</td>
<td>Hintergrundfarbe der App (<code>body</code>-Element)</td>
</tr>
</tbody></table>
<p>Wir schauen uns das Ergebnis nun im Safari-Browser unter iOS an. Nach dem Ã–ffnen der Seite kÃ¶nnen wir diese Ã¼ber die Funktion "Add to Homescreen" auf dem Apple-GerÃ¤t speichern.
Wir sehen, dass die App die korrekten Icons nutzt und uns nach der Installation und dem Start zunÃ¤chst kurz den Splashscreen zeigt, bevor die App vollflÃ¤chig dargestellt wird. Die Statusbar ist in unserem Fall Schwarz, wie zuvor angegeben.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/bm-pwa-ios-homescreen-splashscreen-start.png" alt="Der BookMonkey als PWA mit Splashscreen unter iOS"></p>
<h2 id="offline-funktionalitÃ¤t">Offline-FunktionalitÃ¤t</h2>
<p>Die Anwendung verhÃ¤lt sich nun wie eine normale Webanwendung. Um mehr das GefÃ¼hl einer nativen App zu erzeugen, betrachten wir als NÃ¤chstes die Offline-FÃ¤higkeit der App.</p>
<h3 id="konfiguration-fÃ¼r-angular-service-worker-anpassen-ngsw-configjson">Konfiguration fÃ¼r Angular Service Worker anpassen (<code>ngsw-config.json</code>)</h3>
<p>Der Angular Service Worker besitzt die Konfigurationsdatei <code>ngsw-config.json</code>
.
Hier wird definiert, welche Ressourcen und Pfade gecacht werden sollen und welche Strategie hierfÃ¼r verwendet wird.
Eine ausfÃ¼hrliche Beschreibung der einzelnen Parameter finden Sie in der offiziellen Dokumentation auf <a href="https://angular.io/guide/service-worker-config">angular.io</a>.</p>
<p>Die beiden groÃŸen BlÃ¶cke der Konfiguration sind die <code>assetGroups</code> und die <code>dataGroup</code>. Im Array <code>assetGroups</code> ist die Konfiguration zu Ressourcen enthalten, die zur App selbst gehÃ¶ren. Hierzu zÃ¤hlen zum Beispiel statische Bilder, CSS-Stylesheets, Third-Party-Ressourcen, die von CDNs geladen werden etc.
Das Array <code>dataGroup</code>, beinhaltet Ressourcen, die nicht zur App selbst gehÃ¶ren, zum Beispiel API-Aufrufe und andere Daten-AbhÃ¤ngigkeiten.</p>
<p>Wir wollen bei unserer Beispielanwendung zunÃ¤chst erwirken, dass die Antworten von der HTTP-API gecacht werden: die Liste der BÃ¼cher, bereits angesehene einzelne BÃ¼cher und auch die Suchresultate.
Diese Ergebnisse kÃ¶nnen dann also auch angezeigt werden, wenn keine Netzwerkverbindung besteht.
Dazu passen wir die Datei <code>ngsw-config.json</code> an und erweitern diese wie folgt:</p>
<blockquote>
<p>Achtung! Wenn Sie Ã„nderungen am Quellcode durchfÃ¼hren, werden Ihnen ggf. beim Aktualisieren der Anwendung im Browser alte (gecachte) Daten angezeigt. Sie sollten deshalb wÃ¤hrend der Entwicklung stets einen neuen Incognito-Tab im Browser nutzen. SchlieÃŸen Sie den Tab und laden die Anwendung neu, erhalten Sie eine "frische" Anwendung. Achten Sie auch darauf, dass in den Google Chrome Developer Tools die Option <em>Disable Cache</em> deaktiviert ist.</p>
</blockquote>
<pre><code class="language-json">{
  <span class="hljs-attr">"$schema"</span>: <span class="hljs-string">"./node_modules/@angular/service-worker/config/schema.json"</span>,
  <span class="hljs-attr">"index"</span>: <span class="hljs-string">"/index.html"</span>,
  <span class="hljs-attr">"assetGroups"</span>: [ <span class="hljs-comment">/* ... */</span> ],
  <span class="hljs-attr">"dataGroups"</span>: [
    {
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Books"</span>,
      <span class="hljs-attr">"urls"</span>: [
        <span class="hljs-string">"/secure/books"</span>,
        <span class="hljs-string">"/secure/books/search/**"</span>,
        <span class="hljs-string">"/secure/book/**"</span>
      ],
      <span class="hljs-attr">"cacheConfig"</span>: {
        <span class="hljs-attr">"strategy"</span>: <span class="hljs-string">"freshness"</span>,
        <span class="hljs-attr">"maxSize"</span>: <span class="hljs-number">50</span>,
        <span class="hljs-attr">"maxAge"</span>: <span class="hljs-string">"1d2h"</span>,
        <span class="hljs-attr">"timeout"</span>: <span class="hljs-string">"3s"</span>
      }
    }
  ]
}
</code></pre>
<p>Wir verwenden an dieser Stelle den Block <code>dataGroups</code>, da unsere Buchdatenbank keine statischen Daten enthÃ¤lt, die direkt zur App gehÃ¶ren.
Dem neuen Abschnitt in <code>dataGroups</code> geben wir die selbst festgelegte Bezeichnung <code>Books</code>. Wir definieren damit, dass alle Aufrufe unter <code>/secure/books</code> vom Service Worker behandelt werden sollen. Dasselbe gilt auch fÃ¼r alle anderen definierten Pfade zur HTTP-API.
Im letzten Schritt definieren wir das Verhalten des Caches. Wir wollen hier die Strategie <code>freshness</code> verwenden: Sie besagt, dass idealerweise die aktuellen Daten abgerufen werden, bevor sie aus dem Cache bezogen werden.
Erhalten wir jedoch ein Netzwerk-Timeout nach Ablauf der definierten Zeit im Parameter <code>timeout</code>, werden die zuletzt gecachten Daten ausgeliefert. Die Strategie eignet sich vor allem fÃ¼r dynamische Daten, die Ã¼ber eine API bezogen werden, und die mÃ¶glichst immer im aktuellen Stand reprÃ¤sentiert werden sollen.
Die Option <code>maxSize</code> definiert die maximale Anzahl von EintrÃ¤gen im Cache. <code>maxAge</code> gibt die maximale GÃ¼ltigkeit der Daten im Cache an, in unserem Fall sollen die Daten einen Tag und 2 Stunden gÃ¼ltig sein.</p>
<p>Eine zweite mÃ¶gliche Strategie fÃ¼r den Cache ist die Einstellung <code>performance</code>. Diese liefert immer zunÃ¤chst die Daten aus dem Cache, solange diese gÃ¼ltig sind.
Erst wenn der <code>timeout</code> ablÃ¤uft, werden die Daten im Cache aktualisiert. Diese Strategie eignet sich fÃ¼r Daten, die nicht sehr oft geÃ¤ndert werden mÃ¼ssen oder bei denen eine hohe AktualitÃ¤t keine groÃŸe Relevanz hat.</p>
<p>Schauen wir uns nun wieder unsere Anwendung an und deaktivieren die Netzwerkverbindung nach dem erstmaligen Abrufen der Buchliste, so sehen wir, dass weiterhin Buchdaten angezeigt werden, wenn wir die Anwendung neu laden oder in ihr navigieren.</p>
<h3 id="die-pwa-updaten">Die PWA updaten</h3>
<p>Ein Service Worker wird automatisch im Browser installiert und ist dort aktiv.
Stellt der Server eine neue Version zur VerfÃ¼gung, so muss der Service Worker im Browser aktualisiert werden.
Solche Updates werden in Angular Ã¼ber den Service <code>SwUpdate</code> behandelt. Dieser liefert uns Informationen Ã¼ber ein verfÃ¼gbares bzw. durchgefÃ¼hrtes Update, auf die wir reagieren kÃ¶nnen. In der Regel werden Service Worker im Hintergrund geupdatet und die Nutzer bekommen davon nichts mit.
Es kann jedoch hilfreich sein, dem Nutzer mitzuteilen, dass ein Update vorliegt, um beispielsweise Ã¼ber Neuerungen zu informieren.
Wir wollen genau diesen Fall implementieren.</p>
<p>ZunÃ¤chst passen wir dafÃ¼r die Datei <code>ngsw-config.json</code> an. Hier fÃ¼gen wir den Abschnitt <code>appData</code> ein. Dieser kann Informationen wie eine Beschreibung, die Version und weitere Metadaten zur Anwendung enthalten. Wir wollen in diesem Abschnitt eine Versionsnummer sowie einen Changelog hinterlegen, den wir spÃ¤ter bei einem Update den Nutzern anzeigen wollen.</p>
<blockquote>
<p>Achtung: Die Versionsnummer dient lediglich als Nutzerinformation. Hinter den Kulissen erfolgt jedoch ein BinÃ¤rvergleich des erzeugten Service Workers aus der <code>ngsw-config.json</code>. Jede kleinste Ã„nderung an der <code>ngsw-config.json</code> fÃ¼hrt somit zu einem neuen Service Worker unabhÃ¤ngig von der von uns hinterlegten Versionsnummer.</p>
</blockquote>
<pre><code class="language-json">{
  <span class="hljs-attr">"$schema"</span>: <span class="hljs-string">"./node_modules/@angular/service-worker/config/schema.json"</span>,
  <span class="hljs-attr">"index"</span>: <span class="hljs-string">"/index.html"</span>,
  <span class="hljs-attr">"appData"</span>: {
    <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.1.0"</span>,
    <span class="hljs-attr">"changelog"</span>: <span class="hljs-string">"aktuelle Version"</span>
  },
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>AnschlieÃŸend bauen wir die Anwendung (<code>ng build --prod</code>) und rufen sie im Browser auf â€“ bis hierhin ist alles wie gehabt.
Nun wollen wir, dass der Nutzer Ã¼ber Ã„nderungen informiert wird.
DafÃ¼r nutzen wir den Service <code>SwUpdate</code>. Er stellt das Observable <code>available</code> zur VerfÃ¼gung, das wir abonnieren kÃ¶nnen.
Sobald ein neuer Service Worker verfÃ¼gbar ist, wird dieses Event ausgelÃ¶st.
Wir kÃ¶nnen nun einen Confirm-Dialog anzeigen und den Nutzer fragen, ob ein Update durchgefÃ¼hrt werden soll.
Das Event aus dem Observable liefert uns auÃŸerdem die komplette Konfiguration von <code>appData</code> aus der <code>ngsw-config.json</code> in der aktuellen Version sowie in der neuen Version des Service Workers.
BestÃ¤tigt der Nutzer nun den Dialog mit <em>OK</em>, erfolgt ein Neuladen der Seite, was ein Update des Service Workers zur Folge hat.</p>
<pre><code class="language-ts"><span class="hljs-keyword">import</span> { Component, OnInit } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/core'</span>;
<span class="hljs-keyword">import</span> { SwUpdate } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/service-worker'</span>;

<span class="hljs-meta">@Component</span>({ <span class="hljs-comment">/* ... */</span> })
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span> </span>{

  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> swUpdate: SwUpdate</span>)</span> {}

  <span class="hljs-function"><span class="hljs-title">ngOnInit</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.swUpdate.isEnabled) {
      <span class="hljs-built_in">this</span>.swUpdate.available.subscribe(<span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> updateApp = <span class="hljs-built_in">window</span>.confirm(<span class="hljs-string">`
          Ein Update ist verfÃ¼gbar (<span class="hljs-subst">${evt.current.appData[<span class="hljs-string">'version'</span>]}</span> =&gt; <span class="hljs-subst">${evt.available.appData[<span class="hljs-string">'version'</span>]}</span>).
          Ã„nderungen: <span class="hljs-subst">${evt.current.appData[<span class="hljs-string">'changelog'</span>]}</span>
          Wollen Sie das Update jetzt installieren?
        `</span>);
        <span class="hljs-keyword">if</span> (updateApp) { <span class="hljs-built_in">window</span>.location.reload(); }
      });
    }
  }
}
</code></pre>
<p>Um nun tatsÃ¤chlich einen neuen Service Worker zu erhalten, mÃ¼ssen wir noch Ã„nderungen an der <code>ngsw-config.json</code> vornehmen, damit nach dem BinÃ¤rvergleich eine neue Version des Service Workers erzeugt wird. Wir Ã¤ndern hier lediglich die Versionsnummer sowie das Changelog.</p>
<blockquote>
<p>An dieser Stelle sei nochmals angemerkt, dass die Versionsnummer keine tatsÃ¤chliche Version des Service Workers darstellt. Wir kÃ¶nnten hier auch eine niedrigere Versionsnummer angeben, und es wÃ¼rde trotzdem ein Update des Service Workers erfolgen.</p>
</blockquote>
<pre><code class="language-json">{
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">"appData"</span>: {
    <span class="hljs-attr">"version"</span>: <span class="hljs-string">"2.0.0"</span>,
    <span class="hljs-attr">"changelog"</span>: <span class="hljs-string">"Caching bereits abgerufener BÃ¼cher"</span>
  },
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>Erzeugen wir die Anwendung neu und starten wieder den Webserver, so sehen wir, dass kurz nach dem Laden der Seite ein Hinweis zum Update erscheint. BestÃ¤tigen wir mit <em>OK</em>, wird die Seite neu geladen und es wird fortan der neu erzeugte Service Worker verwendet.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/bm-pwa-update.png" alt="Screenshot Anzeige eines Updates der PWA"></p>
<h2 id="push-notifications">Push Notifications</h2>
<p>Zum Abschluss wollen wir uns noch der dritten wichtigen Charakteristik von PWAs widmen: den Push Notifications.
Diese ermÃ¶glichen es uns, vom Server aus Benachrichtigungen an Clients zu senden, die zuvor den Benachrichtigungsdienst aktiviert haben.
Push Notifications werden ebenfalls mithilfe von Service Workern implementiert.</p>
<p>Die nachfolgende Abbildung stellt den Ablauf von Push-Benachrichtigungen schematisch dar. Im ersten Schritt abonnieren ein oder mehrere Clients die Benachrichtigungen (1).
AnschlieÃŸend soll in unserem Fall das Anlegen eines neuen Buchs auf dem Server (2) dazu fÃ¼hren, dass alle Abonnenten darÃ¼ber benachrichtigt werden (3). In Schritt 4 wollen wir reagieren, wenn die Benachrichtigung angeklickt wird und wollen das neu angelegte Buch Ã¶ffnen (4).</p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwa-notification-flow.svg" alt="Flow: PWA Push Notifications"></p>
<p>Um Push-Benachrichtigungen vom Server an die Clients zu schicken, kommt die sogenannte <a href="https://developer.mozilla.org/en-US/docs/Web/API/Push_API">Push API</a> zum Einsatz, die moderne Browser nativ unterstÃ¼tzen.
Die Technologie wird auch <em>WebPush</em> genannt.</p>
<p>Wir legen als Erstes einen neuen Service an, der sich um die Push Notifications kÃ¼mmern soll: <code>ng generate service web-notification</code>.
Das read-only Property <code>VAPID_PUBLIC_KEY</code> enthÃ¤lt den Public-Key der BookMonkey API. Dieser wird fÃ¼r die Kommunikation zwischen dem Service Worker und dem Server mit WebPush zwingend benÃ¶tigt.</p>
<p>Angular stellt den Service <code>SwPush</code> zur VerfÃ¼gung, der die native FunktionalitÃ¤t kapselt.
Ãœber <code>isEnabled</code> greifen wir auf <code>SwPush</code> zu, und wir erhalten Aufschluss darÃ¼ber, ob der verwendete Browser bzw. das genutzte GerÃ¤t grundsÃ¤tzlich  Push Notifications unterstÃ¼tzt.
Die Methode <code>requestSubscription()</code> von <code>SwPush</code> fordert an, dass Push-Nachrichten im Browser aktiviert werden.
Dazu muss der Public-Key des Servers Ã¼bermittelt werden.
Der Nutzer muss daraufhin im Browser bestÃ¤tigen, dass die Anwendung Push-Nachrichten an das GerÃ¤t schicken darf.
Stimmt der Nutzer zu, wird die Methode <code>sendToServer()</code> mit dem zurÃ¼ckgelieferten Objekt vom Typ <code>PushSubscriptionJSON</code> aufgerufen.
Das Objekt enthÃ¤lt die notwendigen Abonnement-Daten, die der Server fÃ¼r die Speicherung und Adressierung der einzelnen Abonnenten benÃ¶tigt.
Wir Ã¼bermitteln das Objekt mit einem HTTP-POST-Request an den Server.</p>
<pre><code class="language-ts"><span class="hljs-comment">// ...</span>
<span class="hljs-keyword">import</span> { HttpClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/common/http'</span>;
<span class="hljs-keyword">import</span> { SwPush } <span class="hljs-keyword">from</span> <span class="hljs-string">'@angular/service-worker'</span>;

<span class="hljs-meta">@Injectable</span>({ <span class="hljs-comment">/* ... */</span> })
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebNotificationService</span> </span>{
  <span class="hljs-keyword">readonly</span> VAPID_PUBLIC_KEY = <span class="hljs-string">'BGk2Rx3DEjXdRv9qP8aKrypFoNjISAZ54l-3V05xpPOV-5ZQJvVH9OB9Rz5Ug7H_qH6CEr40f4Pi3DpjzYLbfCA'</span>;
  <span class="hljs-keyword">private</span> baseUrl = <span class="hljs-string">'https://api3.angular-buch.com/notifications'</span>;

  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> http: HttpClient,
    <span class="hljs-keyword">private</span> swPush: SwPush
  </span>)</span> { }

  <span class="hljs-keyword">get</span> <span class="hljs-title">isEnabled</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.swPush.isEnabled;
  }

  subscribeToNotifications(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.swPush.requestSubscription({
      <span class="hljs-attr">serverPublicKey</span>: <span class="hljs-built_in">this</span>.VAPID_PUBLIC_KEY
    })
    .then(<span class="hljs-function"><span class="hljs-params">sub</span> =&gt;</span> <span class="hljs-built_in">this</span>.sendToServer(sub))
    .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Could not subscribe to notifications'</span>, err));
  }

  <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-title">sendToServer</span>(<span class="hljs-params">params: PushSubscriptionJSON</span>)</span> {
    <span class="hljs-built_in">this</span>.http.post(<span class="hljs-built_in">this</span>.baseUrl, params).subscribe();
  }
}
</code></pre>
<p>Im nÃ¤chsten Schritt wollen wir den neuen Service einsetzen und navigieren dazu zurÃ¼ck in den Code der <code>app.component.ts</code>.
Wir legen das Property <code>permission</code> als Hilfe an, um den Nutzern spÃ¤ter im Template den entsprechenden Status der Push Notifications anzuzeigen.
Ãœber das globale Objekt <code>Notification.permission</code> erhalten wir vom Browser den Wert <code>default</code>, sofern noch keine Auswahl getroffen wurde, ob Benachrichtigungen durch den Nutzer genehmigt wurden.
BestÃ¤tigt ein Nutzer die Nachfrage, wird der Wert <code>granted</code> gesetzt. Bei Ablehnung erhalten wir den Wert <code>denied</code>.
Als initialen Wert verwenden wir <code>null</code> â€“ derselbe Wert wird ebenso verwendet, wenn der Benachrichtigungsdienst nicht unterstÃ¼tzt wird.
Zum Abschluss benÃ¶tigen wir noch eine Methode, mit der der initiale Request gestellt wird, die Push-Nachrichten zu aktivieren: <code>submitNotification()</code>. Die Methode soll beim Klick auf einen Button ausgefÃ¼hrt werden und nutzt den eben erstellen <code>WebNotificationService</code>.
Sobald der Nutzer eine Auswahl getroffen hat, wollen wir den Wert des Propertys <code>permission</code> updaten.</p>
<pre><code class="language-ts"><span class="hljs-comment">// ...</span>
<span class="hljs-keyword">import</span> { WebNotificationService } <span class="hljs-keyword">from</span> <span class="hljs-string">'./shared/web-notification.service'</span>;

<span class="hljs-meta">@Component</span>({<span class="hljs-comment">/* ... */</span>})
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppComponent</span> <span class="hljs-title">implements</span> <span class="hljs-title">OnInit</span> </span>{
  <span class="hljs-attr">permission</span>: NotificationPermission | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> swUpdate: SwUpdate,
    <span class="hljs-keyword">private</span> webNotificationService: WebNotificationService
  </span>)</span> {}

  <span class="hljs-function"><span class="hljs-title">ngOnInit</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-built_in">this</span>.permission = <span class="hljs-built_in">this</span>.webNotificationService.isEnabled ? Notification.permission : <span class="hljs-literal">null</span>;
  }

  <span class="hljs-function"><span class="hljs-title">submitNotification</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">this</span>.webNotificationService.subscribeToNotifications()
      .then(<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">this</span>.permission = Notification.permission);
  }
}
</code></pre>
<p>Zum Schluss fehlen nur noch ein paar kleine Anpassungen am Template (<code>app.component.html</code>).
Hier wollen wir einen MenÃ¼punkt mit einem Button im rechten Bereich der MenÃ¼leiste einfÃ¼gen.
Der Button soll deaktiviert sein, sofern keine Push Notifications unterstÃ¼tzt werden (z. B. im Development-Modus von Angular oder wenn der genutzte Browser diese Funktion nicht unterstÃ¼tzt).
Wird die Funktion unterstÃ¼tzt, prÃ¼fen wir noch auf die drei ZustÃ¤nde <code>default</code>, <code>granted</code> und <code>denied</code>. Die <a href="https://semantic-ui.com/elements/button.html">CSS-Klassen von Semantic UI</a> sorgen fÃ¼r das entsprechende Styling.
Die CSS-Klasse <code>mini</code> im Ã¼bergeordneten <code>&lt;div&gt;</code> macht das MenÃ¼ etwas kleiner, sodass es auch auf dem Smartphone gut aussieht.</p>
<pre><code class="language-html"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui mini menu"</span>&gt;</span>
  &lt;!-* ... --&gt;
  </span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"right menu"</span>&gt;</span>
    </span><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ui button"</span>
        (<span class="hljs-attr">click</span>)=<span class="hljs-string">"submitNotification()"</span>
        [<span class="hljs-attr">ngClass</span>]=<span class="hljs-string">"</span></span></span><span class="xquery">{
          <span class="hljs-string">'disabled'</span>: !permission,
          <span class="hljs-string">'default'</span>:  permission === <span class="hljs-string">'default'</span>,
          <span class="hljs-string">'positive'</span>: permission === <span class="hljs-string">'granted'</span>,
          <span class="hljs-string">'negative'</span>: permission === <span class="hljs-string">'denied'</span>
        }</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span>
      &gt;</span>Benachrichtigungen<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span><span class="xml">
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/div&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">router-outlet</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-outlet</span>&gt;</span></span>
</code></pre>
<p>Geschafft! Schauen wir uns nun das Resultat im Development-Modus an, sehen wir, dass der Button ausgegraut und nicht klickbar ist, da hier die Notifications nicht unterstÃ¼tzt werden.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwa-notification-disabled.png" alt="Screenshot: PWA Push Notifications disabled"></p>
<p>Bauen wir die Anwendung hingegen im Production-Modus und starten den <code>angular-http-server</code>, so ist der Button klickbar und ist zunÃ¤chst im Zustand <code>default</code>.
Klicken wir den Button an, fragt uns der Browser, ob wir Push Notifications aktivieren wollen.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwa-notification-default.png" alt="Screenshot: PWA Access to Push Notifications default"></p>
<p>Wenn wir den Zugriff gewÃ¤hren, wird der Button durch die CSS-Klasse <code>success</code> grÃ¼n, und wir erhalten vom Server direkt eine erste BestÃ¤tigung, dass die Benachrichtigungen aktiviert wurden.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwa-notification-success.png" alt="Screenshot: PWA Success Push Notification"></p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwa-notification-granted.png" alt="Screenshot: PWA Access to Push Notifications granted"></p>
<p>Der API-Server unterstÃ¼tzt bereits WebPush: Wird nun ein neues Buch zur API hinzugefÃ¼gt, erhalten wir eine Push-Benachrichtigung! Sie kÃ¶nnen das Feature ausprobieren, indem Sie entweder Ã¼ber die App selbst ein Buch hinzufÃ¼gen, oder indem Sie die <a href="https://api3.angular-buch.com/swagger-ui/#/book/post_book">BookMonkey API</a> dafÃ¼r nutzen.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwa-notification-new-book.png" alt="Screenshot: PWA Push Notification bei einem neuen Buch"></p>
<p>Lehnen wir hingegen ab, Benachrichtigungen zu erhalten, so fÃ¤rbt sich der Button rot, und wir werden nicht Ã¼ber neue BÃ¼cher informiert.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwa-notification-denied.png" alt="Screenshot: PWA Access to Push Notifications denied"></p>
<p>Unter iOS wird die FunktionalitÃ¤t nicht unterstÃ¼tzt, daher bleibt der Button ausgegraut:</p>
<table>
<thead>
<tr>
<th align="center">Screenshot Android</th>
<th align="center">Screenshot iOS</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwa-notification-enabled-android.png" alt="Screenshot Android"> <small>Benachrichtigungen werden unterstÃ¼tzt</small></td>
<td align="center"><img src="https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwa-notification-not-enabled-ios.png" alt="Screenshot iOS">  <small>Benachrichtigungen werden nicht unterstÃ¼tzt</small></td>
</tr>
</tbody></table>
<h3 id="auf-die-push-notification-reagieren">Auf die Push Notification reagieren</h3>
<p>Wir wollen zum Abschluss noch einen Schritt weiter gehen und darauf reagieren, dass ein Nutzer auf die angezeigte Benachrichtigung klickt.
HierfÃ¼r stellt der Service <code>SwPush</code> das Observable <code>notificationClicks</code> zur VerfÃ¼gung.
Mit der Benachrichtigung wird im Property <code>data</code> eine URL angegeben, die zur Seite des neu angelegten Buchs fÃ¼hrt.
Wir wollen diese URL nutzen und ein neues Browser-Fenster mit der angegebenen URL Ã¶ffen.</p>
<blockquote>
<p>Achtung: An dieser Stelle mÃ¼ssen wir <code>window.open()</code> nutzen und nicht den Angular-Router, da die Methode <code>notificationClicks()</code> im Service Worker aufgerufen wird und die Benachrichtigung ggf. erst erscheint, wenn wir die App bereits geschlossen haben.</p>
</blockquote>
<pre><code class="language-ts"><span class="hljs-comment">// ...</span>
<span class="hljs-meta">@Injectable</span>({ <span class="hljs-comment">/* ... */</span> })
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WebNotificationService</span> </span>{
  <span class="hljs-comment">// ...</span>
  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> http: HttpClient,
    <span class="hljs-keyword">private</span> swPush: SwPush
  </span>)</span> {
    <span class="hljs-built_in">this</span>.swPush.notificationClicks.subscribe(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> url = event.notification.data.url;
      <span class="hljs-built_in">window</span>.open(url, <span class="hljs-string">'_blank'</span>);
    });
  }
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>Die Push Notifications aus dem Service Worker sind ein effektiver Weg, um die Aufmerksamkeit des Nutzers gezielt auf die Anwendung zu lenken.
Die Nachricht verhÃ¤lt sich wie eine native Benachrichtigung jeder anderen App.
Im Hintergrund wird die Technologie WebPush eingesetzt, die fest mit dem Angular-Service <code>SwPush</code> verdrahtet ist.
<code>SwPush</code> bietet also keine einfache MÃ¶glichkeit, eine Nachricht aus einer lokalen Quelle anzuzeigen.</p>
<h3 id="ein-blick-unter-die-haube-von-push-notifications">Ein Blick unter die Haube von Push Notifications</h3>
<p>Haben wir alle Teile korrekt implementiert, kann der Client Push-Nachrichten vom Server empfangen.
Wir wiederholen kurz dem Ablauf:
Der Client macht sich zunÃ¤chst beim Server bekannt, indem er ein Objekt vom Typ <code>PushSubscription</code> an den Server Ã¼bermittelt.
In unserem Beispiel haben wir dazu die Service-Methode <code>sendToServer()</code> verwendet.
Der Server speichert dieses Objekt und verwendet es, um Nachrichten an den registrieren Service Worker zu Ã¼bermitteln.
So wird es ermÃ¶glicht, dass auch Nachrichten empfangen werden kÃ¶nnen, wenn die Anwendung geschlossen ist.</p>
<p>Aber wie funktioniert der RÃ¼ckkanal vom Server zum Client?
Dazu schauen wir uns das automatisch generierte Objekt vom Typ <code>PushSubscription</code> einmal genauer an:</p>
<pre><code class="language-json">{
  <span class="hljs-attr">"endpoint"</span>: <span class="hljs-string">"https://fcm.googleapis.com/fcm/send/erSmNAsF0ew:APA91bGfjlCRi8nIpG9fvxezt_2E0JcfJ0I_4gnm2M29JQ3kF3d_XxUqrlQatWNGotPtsW-M57vsLxhNz9vRz0IQr3KB50Dm2wjm7gAbVo1c00VpDv7-2JynXNGk1RqimZ-TfYzzAjdu"</span>,
  <span class="hljs-attr">"expirationTime"</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">"keys"</span>: {
    <span class="hljs-attr">"p256dh"</span>:<span class="hljs-string">"BO4BdhfvZ4bo3hh7NBJDb--OZWcQ37M0O8XZY6lJ67g3x7JvmzMJhz_w_EaEVKFLskkDccO3iKsXkxtlSromdzU"</span>,
    <span class="hljs-attr">"auth"</span>:<span class="hljs-string">"IH-eOcRdlxZ8P8uLl-2e6g"</span>
  }
}
</code></pre>
<p>Besonders interessant ist das Property <code>endpoint</code>: Der Browser Ã¼bermittelt eine URL, Ã¼ber die der Server Nachrichten an den Client schicken kann.
Der Server sendet dazu lediglich einen HTTP-Request an diese URL.
Die Notwendigkeit der VerschlÃ¼sselung mit den VAPID-Keys wird hier noch einmal deutlicher.</p>
<p>Ebenso interessant ist, dass die Endpoint-URL aus dem Universum des Browserherstellers kommt.
Bitte behalten Sie diesen Punkt stets im Hinterkopf: Alle Push-Nachrichten werden immer durch einen fremden Server zum Client gebracht.</p>
<h2 id="zusammenfassung">Zusammenfassung</h2>
<p>Wie Sie sehen, gelingt der Einstieg in die Entwicklung von Progressive Web Apps ohne Probleme.
Dank der vorbereiteten Schematics kÃ¶nnen wir uns auf die eigentliche Implementierung von Features konzentrieren.
Dies war aber nur ein kleiner Einblick in Progressive Web Apps mit Angular.
Wer noch mehr zum Thema erfahren mÃ¶chte, dem sei der Blogpost <a href="https://itnext.io/build-a-production-ready-pwa-with-angular-and-firebase-8f2a69824fcc">"Build a production ready PWA with Angular and Firebase"</a> von Ã–nder Ceylan empfohlen.</p>
<p>Den vollstÃ¤ndigen Quelltext aus diesem Artikel kÃ¶nnen Sie auf <a href="https://github.com/angular-buch/book-monkey3-pwa">auf GitHub</a> herunterladen.
Eine <strong>Demo des BookMonkey als PWA</strong> finden Sie unter der <a href="https://bm3-pwa.angular-buch.com">https://bm3-pwa.angular-buch.com</a> â€“ probieren Sie die App am Besten auf Ihrem Smartphone aus!</p>
<p>Viel SpaÃŸ beim Programmieren!</p>
<hr>
<p><small><strong>Titelbild:</strong> Photo by rawpixel.com from Pexels, angepasst</small></p>
</p><!----><!----><a routerlink="/blog" ripple-radius="" class="btn btn-sm btn-primary mt-4" href="/blog"><i class="fa fa-backward mr-2"></i> ZurÃ¼ck</a><hr> Suggestions? Feedback? Bugs? Please <a target="_blank" class="content" href="https://github.com/angular-buch/website-articles/blob/gh-pages/blog/2019-07-progressive-web-app/README.md"><i class="fa fa-github mr-1" style="font-size: 1.6rem; position: relative; bottom: -3px;"></i>fork/edit this page on Github</a>. </div></div></div></div></div><!----></div><!----></div></section><ngx-json-ld><script type="application/ld+json">{
  "url": "https://angular.schule/blog/2019-07-progressive-web-app",
  "headline": "Mach aus deiner Angular-App eine PWA",
  "description": "Immer hÃ¤ufiger stÃ¶ÃŸt man im Webumfeld auf den Begriff der Progessive Web App â€“ kurz: PWA. Doch was genau steckt dahinter und welche Vorteile hat eine PWA gegenÃ¼ber einer herkÃ¶mmlichen Webanwendung oder einer App?\nAls Progressive Web App bezeichnen wir eine Webanwendung, die beim Aufruf einer Website als App auf einem lokalen GerÃ¤t installiert werden kann â€“ zum Beispiel auf dem Telefon oder Tablet.\nDie PWA lÃ¤sst sich wie jede andere App nutzen, inklusive Push-Benachrichtigungen!",
  "datePublished": "2019-07-24",
  "dateModified": "2019-07-24",
  "publisher": {
    "name": "Angular-Buch",
    "url": "https://angular-buch.com",
    "@type": "Organization",
    "logo": {
      "@type": "ImageObject",
      "url": "https://angular-buch.com/assets/img/brand_export.png"
    }
  },
  "image": "https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwaheader.jpg",
  "thumbnailUrl": "https://website-articles.angular-buch.com/blog/2019-07-progressive-web-app/pwaheader.jpg",
  "author": {
    "@type": "Person",
    "name": "Danny Koppenhagen",
    "email": "mail@d-koppenhagen.de"
  },
  "keywords": [
    "PWA",
    "Progressive Web App",
    "Angular",
    "Service Worker",
    "Web App Manifest",
    "Caching",
    "Push Notification"
  ],
  "mainEntityOfPage": "http://schema.org/WebPage",
  "@type": "Article",
  "@context": "http://schema.org"
}</script></ngx-json-ld></app-blog-details><!----><footer><div class="container"><div class="row align-items-center"><div class="col-sm-9"><div class="links"><app-link><!----><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/"><!----> Home </a><!----><!----><!----></app-link>|<!----><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/impressum"><!----> Impressum </a><!----><!----><!----><!----></app-link>|<!----><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/datenschutz"><!----> DatenschutzerklÃ¤rung </a><!----><!----><!----><!----></app-link>|<!----><app-link><!----><a class="links__item links__twitter" href="https://twitter.com/angular_buch" rel="nofollow"><!----> Twitter </a><!----><!----><!----><!----><!----></app-link><!----><!----></div></div><div class="col-sm-3 text-right"></div></div></div></footer></main><ngx-json-ld><script type="application/ld+json"></script></ngx-json-ld><ngx-json-ld><script type="application/ld+json"></script></ngx-json-ld></app-root>
<script src="runtime.cf98c39ac9cb9df9.js" type="module"></script><script src="polyfills.3ff675c472c2ffab.js" type="module"></script><script src="main.5c265f25c9610430.js" type="module"></script>

</body></html>