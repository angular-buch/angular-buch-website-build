<!DOCTYPE html><html lang="de" data-critters-container=""><head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#"><meta name="generator" content="Scully 0.0.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <title>Angular-Buch ‚Üí Trusted Web Activitys (TWA) mit Angular</title>
  

  

  <meta property="book:author" content="https://www.facebook.com/ferdinand.malcher">
  <meta property="book:author" content="https://www.facebook.com/johannes.hoppe">

  <meta property="book:isbn" content="9783864909467">
  <meta property="book:release_date" content="2023-02-28">
  <meta property="book:tag" content="Angular">
  <meta property="book:tag" content="Webentwicklung">
  <meta property="book:tag" content="AngularJS">
  <meta property="book:tag" content="TypeScript">
  <meta property="book:tag" content="JavaScript">
  <meta property="book:tag" content="HTML5">
  <meta property="book:tag" content="CSS">
  <meta property="book:tag" content="RxJS">
  <meta property="book:tag" content="Redux">
  <meta property="book:tag" content="NgRx">

  <base href="/">
<style>@charset "UTF-8";@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0)}to{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@font-face{font-family:Roboto;src:url(./media/Roboto-Thin-GAS35NAQ.eot);src:local("Roboto Thin"),local("Roboto-Thin"),url(./media/Roboto-Thin-GAS35NAQ.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Thin-UUU7IP4L.woff2) format("woff2"),url(./media/Roboto-Thin-BT5WDCMC.woff) format("woff"),url(./media/Roboto-Thin-STLHGJGZ.ttf) format("truetype"),url(./media/Roboto-Thin-OYOYLS5N.svg#Roboto) format("svg");font-weight:100;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-ThinItalic-HQCJJ3KQ.eot);src:local("Roboto ThinItalic"),local("Roboto-ThinItalic"),url(./media/Roboto-ThinItalic-HQCJJ3KQ.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-ThinItalic-PVCCLVHZ.woff2) format("woff2"),url(./media/Roboto-ThinItalic-OJCFQICS.woff) format("woff"),url(./media/Roboto-ThinItalic-OKVQEY6M.ttf) format("truetype"),url(./media/Roboto-ThinItalic-PU7U6F54.svg#Roboto) format("svg");font-weight:100;font-style:italic}@font-face{font-family:Roboto;src:url(./media/Roboto-Light-TT7V6J7W.eot);src:local("Roboto Light"),local("Roboto-Light"),url(./media/Roboto-Light-TT7V6J7W.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Light-OEL5QP53.woff2) format("woff2"),url(./media/Roboto-Light-EGEOUPZ7.woff) format("woff"),url(./media/Roboto-Light-KYCYMX5R.ttf) format("truetype"),url(./media/Roboto-Light-O5NB3DZS.svg#Roboto) format("svg");font-weight:300;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-LightItalic-JJ225GLJ.eot);src:local("Roboto LightItalic"),local("Roboto-LightItalic"),url(./media/Roboto-LightItalic-JJ225GLJ.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-LightItalic-SZU3UOEY.woff2) format("woff2"),url(./media/Roboto-LightItalic-5LJGTDBY.woff) format("woff"),url(./media/Roboto-LightItalic-ZTOFFLND.ttf) format("truetype"),url(./media/Roboto-LightItalic-FE5GYQJO.svg#Roboto) format("svg");font-weight:300;font-style:italic}@font-face{font-family:Roboto;src:url(./media/Roboto-Regular-WINA5356.eot);src:local("Roboto Regular"),local("Roboto-Regular"),url(./media/Roboto-Regular-WINA5356.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Regular-4ZFX4XNS.woff2) format("woff2"),url(./media/Roboto-Regular-EMJ7NDAQ.woff) format("woff"),url(./media/Roboto-Regular-W6LM4ZNI.ttf) format("truetype"),url(./media/Roboto-Regular-DDBAS5OS.svg#Roboto) format("svg");font-weight:400;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-RegularItalic-43QNLNAN.eot);src:local("Roboto RegularItalic"),local("Roboto-RegularItalic"),url(./media/Roboto-RegularItalic-43QNLNAN.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-RegularItalic-2REFJECD.woff2) format("woff2"),url(./media/Roboto-RegularItalic-NSJ4HBKT.woff) format("woff"),url(./media/Roboto-RegularItalic-YZDJVEXU.ttf) format("truetype"),url(./media/Roboto-RegularItalic-7A3VJZ2J.svg#Roboto) format("svg");font-weight:400;font-style:italic}@font-face{font-family:Roboto;src:url(./media/Roboto-Medium-TKOJIIN4.eot);src:local("Roboto Medium"),local("Roboto-Medium"),url(./media/Roboto-Medium-TKOJIIN4.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Medium-GHCC3HN6.woff2) format("woff2"),url(./media/Roboto-Medium-O2PKKQNT.woff) format("woff"),url(./media/Roboto-Medium-ANIBKV6W.ttf) format("truetype"),url(./media/Roboto-Medium-RJM2M5RS.svg#Roboto) format("svg");font-weight:500;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-MediumItalic-5WUL7G7J.eot);src:local("Roboto MediumItalic"),local("Roboto-MediumItalic"),url(./media/Roboto-MediumItalic-5WUL7G7J.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-MediumItalic-FMJUHMWQ.woff2) format("woff2"),url(./media/Roboto-MediumItalic-EJXCUUAA.woff) format("woff"),url(./media/Roboto-MediumItalic-ZZ274MH6.ttf) format("truetype"),url(./media/Roboto-MediumItalic-WUJRBJ2B.svg#Roboto) format("svg");font-weight:500;font-style:italic}@font-face{font-family:Roboto;src:url(./media/Roboto-Bold-BUUHB5PB.eot);src:local("Roboto Bold"),local("Roboto-Bold"),url(./media/Roboto-Bold-BUUHB5PB.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Bold-NGAPMV26.woff2) format("woff2"),url(./media/Roboto-Bold-GE6V3ZS2.woff) format("woff"),url(./media/Roboto-Bold-5VUU6QI6.ttf) format("truetype"),url(./media/Roboto-Bold-UXMYHWKZ.svg#Roboto) format("svg");font-weight:700;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-BoldItalic-ETKPZE3Z.eot);src:local("Roboto BoldItalic"),local("Roboto-BoldItalic"),url(./media/Roboto-BoldItalic-ETKPZE3Z.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-BoldItalic-TBVJ3OTX.woff2) format("woff2"),url(./media/Roboto-BoldItalic-2CYTLDZJ.woff) format("woff"),url(./media/Roboto-BoldItalic-4MMIXUDR.ttf) format("truetype"),url(./media/Roboto-BoldItalic-TDTZWBKI.svg#Roboto) format("svg");font-weight:700;font-style:italic}@font-face{font-family:Roboto;src:url(./media/Roboto-Black-FJBQ2JLX.eot);src:local("Roboto Black"),local("Roboto-Black"),url(./media/Roboto-Black-FJBQ2JLX.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-Black-OEG2WEQ3.woff2) format("woff2"),url(./media/Roboto-Black-AZ2AXCB4.woff) format("woff"),url(./media/Roboto-Black-IGTRSQU4.ttf) format("truetype"),url(./media/Roboto-Black-OEOHVSYK.svg#Roboto) format("svg");font-weight:900;font-style:normal}@font-face{font-family:Roboto;src:url(./media/Roboto-BlackItalic-MXNS7VU5.eot);src:local("Roboto BlackItalic"),local("Roboto-BlackItalic"),url(./media/Roboto-BlackItalic-MXNS7VU5.eot?#iefix) format("embedded-opentype"),url(./media/Roboto-BlackItalic-6QYHVQZM.woff2) format("woff2"),url(./media/Roboto-BlackItalic-7QMDFEK5.woff) format("woff"),url(./media/Roboto-BlackItalic-XIXMO2HU.ttf) format("truetype"),url(./media/Roboto-BlackItalic-EYMGZCJW.svg#Roboto) format("svg");font-weight:900;font-style:italic}:root{--blue: #007bff;--indigo: #6610f2;--purple: #6f42c1;--pink: #e83e8c;--red: #dc3545;--orange: #fd7e14;--yellow: #ffc107;--green: #28a745;--teal: #20c997;--cyan: #17a2b8;--white: #fff;--gray: #6c757d;--gray-dark: #343a40;--primary: #007bff;--secondary: #6c757d;--success: #28a745;--info: #17a2b8;--warning: #ffc107;--danger: #dc3545;--light: #f8f9fa;--dark: #343a40;--breakpoint-xs: 0;--breakpoint-sm: 576px;--breakpoint-md: 768px;--breakpoint-lg: 992px;--breakpoint-xl: 1200px;--font-family-sans-serif: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";--font-family-monospace: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}*,*:before,*:after{box-sizing:border-box}html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,Liberation Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;text-align:left;background-color:#fff}img{vertical-align:middle;border-style:none}svg{overflow:hidden;vertical-align:middle}@media print{*,*:before,*:after{text-shadow:none!important;box-shadow:none!important}img{page-break-inside:avoid}@page{size:a3}body{min-width:992px!important}}body{color:#1e1e1e;font-family:"Roboto","Helvetica Neue",Helvetica,Arial sans-serif;font-size:16px;line-height:1.35em;font-weight:400;background:#F8F8F8}html{overflow-y:scroll}
</style><link rel="stylesheet" href="styles-P6UZRAYA.css" media="all" onload="this.media='all'"><noscript><link rel="stylesheet" href="styles-P6UZRAYA.css"></noscript><link rel="modulepreload" href="chunk-NIB5VS2P.js"><link rel="modulepreload" href="chunk-3H6CBPJ5.js"><link rel="modulepreload" href="chunk-BIU6NKKU.js"><link rel="modulepreload" href="chunk-D75ILFX5.js"><link rel="modulepreload" href="chunk-AZF33QNQ.js"><link rel="modulepreload" href="chunk-QBFS4BAK.js"><link rel="modulepreload" href="chunk-4R7QDBNQ.js"><meta property="og:title" content="Angular-Buch ‚Üí Trusted Web Activitys (TWA) mit Angular"><meta name="twitter:title" content="Angular-Buch ‚Üí Trusted Web Activitys (TWA) mit Angular"><meta name="description" content="üìô Progressive Web Apps sind in den letzten Jahren immer popul√§rer geworden.
Sie erlauben es uns, Webanwendungen auf dem Home-Bildschirm des Smartphones zu installieren und wie eine nativ installierte App zu benutzen.
Mit einer PWA k√∂nnen wir Daten mithilfe eines Service Workers cachen, um die Anwendung auch offline zu verwenden.
Weiterhin kann eine PWA im Hintergrund Push-Benachrichtigungen vom Server empfangen und anzeigen."><meta property="og:description" content="üìô Progressive Web Apps sind in den letzten Jahren immer popul√§rer geworden.
Sie erlauben es uns, Webanwendungen auf dem Home-Bildschirm des Smartphones zu installieren und wie eine nativ installierte App zu benutzen.
Mit einer PWA k√∂nnen wir Daten mithilfe eines Service Workers cachen, um die Anwendung auch offline zu verwenden.
Weiterhin kann eine PWA im Hintergrund Push-Benachrichtigungen vom Server empfangen und anzeigen."><meta name="twitter:description" content="üìô Progressive Web Apps sind in den letzten Jahren immer popul√§rer geworden.
Sie erlauben es uns, Webanwendungen auf dem Home-Bildschirm des Smartphones zu installieren und wie eine nativ installierte App zu benutzen.
Mit einer PWA k√∂nnen wir Daten mithilfe eines Service Workers cachen, um die Anwendung auch offline zu verwenden.
Weiterhin kann eine PWA im Hintergrund Push-Benachrichtigungen vom Server empfangen und anzeigen."><meta name="twitter:site" content="@angular_buch"><meta property="og:locale" content="de"><meta property="og:type" content="website"><meta property="og:url" content="https://angular-buch.com/blog/2020-11-twa"><style>.width-6{width:6.5rem}.width-8{width:8rem}.linkImage{margin-right:3px;margin-top:-3px}
</style><style>.content img{max-width:100%}.details-page-autor{margin-top:-110px}.details-thumbnail{margin-bottom:-18px}.details-thumbnail .details-thumbnail-inner{border-bottom:23px solid #dfdede;max-height:300px;overflow:hidden;background-color:#fff;border-radius:4px;display:flex;justify-content:center}.details-thumbnail .details-thumbnail-inner .darken-overlay{display:block;position:absolute;height:300px;width:100%;padding-left:15px;padding-right:15px;padding-bottom:23px}.details-thumbnail .details-thumbnail-inner .darken-overlay div{display:block;position:relative;width:100%;height:100%;background-color:#0003;border-radius:4px 4px 0 0/4px 4px 0px 0px}.details-thumbnail img{width:100%;align-self:center}.video-container{position:relative;padding-bottom:56.25%;padding-top:0;height:0;overflow:hidden;margin-top:2rem;margin-bottom:2rem}.video-container iframe,.video-container object,.video-container embed{position:absolute;top:0;left:0;width:100%;height:100%}
</style><meta property="og:image" content="https://website-articles.angular-buch.com/blog/2020-11-twa/header-twa.jpg"><meta name="twitter:image" content="https://website-articles.angular-buch.com/blog/2020-11-twa/header-twa.jpg"><meta name="twitter:card" content="summary_large_image"><script>window['ScullyIO']='generated';</script></head>
<body scully-version="0.0.0">
  <app-root ng-version="17.0.0-rc.3"><header><div class="nav__overlay"></div><div class="container"><div class="row no-gutters align-items-center"><div class="col-6 col-md-2"><a routerlink="/" aria-label="Startseite" href="/"><img src="assets/img/brand-400.png" alt="Angular-Buch.com" height="40" width="126" class="img-fluid"></a></div><div class="col-6 col-md-10"><nav><ul><li><app-link><!----><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/"><!----> Buch </a><!----><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/blog" class="nav__current" aria-current="page"><!----> Blog </a><!----><!----><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/material"><!----> Begleitmaterial </a><!----><!----><!----><!----></app-link></li><li><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" href="/kaufen"><img alt="" class="linkImage ls-is-cached lazyloaded" data-src="assets/img/symbol-basket.svg" src="assets/img/symbol-basket.svg"><!----> Jetzt kaufen </a><!----><!----><!----><!----></app-link></li><li><app-link><!----><a class="order" href="//angular.schule/"><img alt="" class="linkImage ls-is-cached lazyloaded" data-src="assets/img/symbol-group.svg" src="assets/img/symbol-group.svg"><!----> Schulungen </a><!----><!----><!----><!----><!----></app-link></li><!----></ul></nav><a href="/" aria-label="Navigation" class="nav__toggle"><img src="assets/img/symbol-menu.svg" alt=""></a></div></div></div></header><main><router-outlet></router-outlet><app-blog-details><app-hero-header headline="Blog" headlinelink="/blog"><section class="hero hero--smaller"><div class="hero__lines"><div class="container"><div class="row justify-content-between"><div class="col-md-6 col-xs-12"><h1 class="headline__page headline__page--blank headline__page--space-bottom"><a style="color: white;" href="/blog">Blog</a><!----><!----></h1></div></div></div></div></section><a name="content" id="content"></a></app-hero-header><section class="index index--list blog mt-n5"><div class="index__stripe index__stripe--list"><!----><div class="container"><a name="post" id="post"></a><div class="row details-thumbnail"><div class="col-12"><div class="details-thumbnail-inner"><img alt="" class="img-fluid rounded lazyloaded" data-src="https://website-articles.angular-buch.com/blog/2020-11-twa/header-twa.jpg" src="https://website-articles.angular-buch.com/blog/2020-11-twa/header-twa.jpg"><!----></div></div><!----></div><div class="row"><div class="col-12"><div class="index__item index__item--list"><div class="row align-items-top"><div class="col-12 col-sm-3 col-md-2 text-center details-page-autor"><img alt="" class="blog__portrait img-fluid rounded-circle lazyloaded" data-src="//www.gravatar.com/avatar/be2ebed82ed399218b89e90abd5bdcc2?size=200&amp;rating=pg&amp;d=mm" src="//www.gravatar.com/avatar/be2ebed82ed399218b89e90abd5bdcc2?size=200&amp;rating=pg&amp;d=mm"><span class="blog__author">Danny Koppenhagen <br><a target="_blank" class="twitter" href="https://twitter.com/d_koppenhagen"> @d_koppenhagen</a> &nbsp; <!----><!----></span></div><div class="col-12 col-sm-9 col-md-10 col-lg-10"><h1 class="blog__headline">Trusted Web Activitys (TWA) mit Angular</h1><p class="blog__date">17.11.2020</p><p class="content markdown-body"><p>Progressive Web Apps sind in den letzten Jahren immer popul√§rer geworden.
Sie erlauben es uns, Webanwendungen auf dem Home-Bildschirm des Smartphones zu installieren und wie eine nativ installierte App zu benutzen.
Mit einer PWA k√∂nnen wir Daten mithilfe eines Service Workers cachen, um die Anwendung auch offline zu verwenden.
Weiterhin kann eine PWA im Hintergrund Push-Benachrichtigungen vom Server empfangen und anzeigen.</p>
<blockquote>
<p>Wenn Sie noch keine Erfahrung mit der Umsetzung einer Angular-App als PWA haben, schauen Sie sich unseren Blog-Post <a href="blog/2019-07-progressive-web-app"><em>"Mach aus deiner Angular-App eine PWA"</em></a> an oder werfen Sie einen Blick in unser <a href="angular-buch.com"><em>Angular-Buch</em></a>, wo wir dieses Thema detailliert erl√§utern.</p>
</blockquote>
<p>Nach der Entwicklung einer PWA bleibt jedoch eine H√ºrde bestehen: Nutzer der Anwendung m√ºssen die URL kennen, √ºber welche die PWA abrufbar ist und installiert werden kann.
Viele Smartphone-Nutzer sind jedoch einen anderen Weg gewohnt, um eine App zu installieren:
Sie suchen danach in einem App Store wie dem <em>Google Play Store</em> unter Android oder <em>App Store</em> unter iOS.</p>
<p>In diesem Blogpost wollen wir Ihnen zeigen, wie Sie Ihre PWA auf einfachem Weg in den Google Play Store f√ºr Android bringen k√∂nnen, ohne eine echte Android-App mit Webview zu entwickeln, die lediglich eine Website aufruft.</p>
<blockquote>
<p><strong>Zur Zeit gibt es noch keine M√∂glichkeit, PWAs in Apples App Store zu deployen.</strong></p>
</blockquote>
<hr>
<p>Inhalt:</p>
<ul>
<li><a href="/blog/2020-11-twa#trusted-web-activities-vs-webview-integration">Trusted Web Activities vs. Webview-Integration</a></li>
<li><a href="/blog/2020-11-twa#twas-im-detail">TWAs im Detail</a></li>
<li><a href="/blog/2020-11-twa#eine-pwa-als-twa-in-den-android-store-bringen">Eine PWA als TWA in den Android Store bringen</a><ul>
<li><a href="/blog/2020-11-twa#einen-android-developer-account-registrieren">Einen Android Developer Account registrieren</a></li>
<li><a href="/blog/2020-11-twa#die-android-app-in-der-google-play-console-erstellen">Die Android-App in der Google Play Console erstellen</a></li>
<li><a href="/blog/2020-11-twa#die-app-signatur-und-das-release-erzeugen">Die App-Signatur und das Release erzeugen</a></li>
<li><a href="/blog/2020-11-twa#den-app-signaturschl-ssel-in-der-pwa-hinterlegen">Den App-Signaturschl√ºssel in der PWA hinterlegen</a></li>
</ul>
</li>
<li><a href="/blog/2020-11-twa#die-twa-mit-der-bubblewrap-cli-erzeugen">Die TWA mit der Bubblewrap CLI erzeugen</a></li>
<li><a href="/blog/2020-11-twa#die-signierte-app-bauen">Die signierte App bauen</a><ul>
<li><a href="/blog/2020-11-twa#mit-der-bublewrap-cli">Mit der Bublewrap CLI</a></li>
<li><a href="/blog/2020-11-twa#mithilfe-von-android-studio">Mithilfe von Android Studio</a></li>
</ul>
</li>
<li><a href="/blog/2020-11-twa#die-app-ber-die-google-play-console-ver-ffentlichen">Die App √ºber die Google Play Console ver√∂ffentlichen</a></li>
</ul>
<hr>
<h2 id="trusted-web-activities-vs-webview-integration">Trusted Web Activities vs. Webview-Integration</h2>
<p>Um PWAs als Android-App bereitzustellen, ben√∂tigen wir eine Art App-Wrapper, der schlie√ülich die PWA aufruft und somit unsere Webanwendung darstellen kann.</p>
<p>In der Vergangenheit wurde dies oft durch Android-Apps umgesetzt, die lediglich einen sogenannten <a href="https://developer.android.com/reference/android/webkit/WebView"><em>WebView</em></a> integrieren.
Hinter diesem Feature versteckt sich ein integrierter Webbrowser in der Android-App, der lediglich den Inhalt der Website darstellt.
Dieser Weg funktioniert f√ºr eine Vielzahl von Websites, ger√§t jedoch an seine Grenzen, wenn es sich bei der Website um eine PWA handelt.
Der Grund: In einem Webview funktionieren die essenziellen Service Worker nicht.
Somit k√∂nnen wir Features wie die Offlinef√§higkeit nicht einfach in die Anwendung integrieren.
Weiterhin birgt ein Webview ein gewisses Sicherheitsrisiko, weil lediglich die URL den Inhalt der Anwendung bestimmt und keinerlei √úberpr√ºfung des tats√§chlichen Contents stattfindet.
Wird also beispielsweise eine Website <em>"gekapert"</em>, bekommt der Nutzer ggf. den Inhalt einer falschen Seite angezeigt.</p>
<p>Bei einer TWA hingegen wird die PWA lediglich so erweitert, dass sie als Android-App direkt deployt werden kann.
√úber einen Sicherheitsschl√ºssel kann verifiziert werden, dass die aufgerufene URL zur App passt.</p>
<h2 id="twas-im-detail">TWAs im Detail</h2>
<p>Die Grundidee einer TWA ist schnell erkl√§rt: Statt einer vollumf√§nglichen Android-App, die einen Browser implementiert und eine URL aufruft, wird bei einer TWA leidglich die PWA um eine App-Schicht erweitert, sodass sie im Google Play Store ver√∂ffentlicht werden kann.
Es muss also auch kein eingebetteter Browser in der App integriert werden, sondern es wird auf den vorhandenen Google Chrome Browser zur√ºckgegriffen.
Voraussetzung hierf√ºr ist, dass auf dem Android-Ger√§t die Version 72 oder h√∂her von Google Chrome verf√ºgbar ist.
Beim √ñffnen der PWA wird Chrome mit der hinterlegten URL ge√∂ffnet, und es werden s√§mtliche UI-Elemente des Browsers ausgeblendet.
Im Prinzip passiert also genau das, was auch geschieht, wenn wir eine PWA √ºber die Funktion <em>"Add To Homescreen"</em> auf Smartphone speichern, jedoch in Form einer App, die √ºber den Google Play Store gefunden und installiert werden kann.
Somit bleiben Features wie Push-Benachrichtigungen, Hintergrundsynchronisierungen, Autofill bei Eingabeformularen, Media Source Extensions oder die Sharing API vollumf√§nglich erhalten.
Ein weiterer Vorteil einer solchen TWA ist, dass Session-Daten und der Cache im Google Chrome geteilt werden.
Haben wir uns also beispielsweise bei unserer Web-Anwendung zuvor im Browser angemeldet, so belibt die Anmeldung in der Android-App (TWA) bestehen.</p>
<p>Die Bezeichnung "Trusted Web Activity" l√§sst bereits darauf schlie√üen: TWAs sind <em>trusted</em>, also vertraulich.
Durch eine spezielle Datei, die mit der Webanwendung ausgeliefert wird und die einen Fingerprint enth√§lt, kann sichergestellt werden, dass die Anwendung vertrauensw√ºrdig ist, und der Inhalt kann somit sicher geladen werden.</p>
<h2 id="eine-pwa-als-twa-in-den-android-store-bringen">Eine PWA als TWA in den Android Store bringen</h2>
<p>Genug der Theorie -- wir wollen nun erfahren, wie wir eine PWA im Android Store als TWA bereitstellen k√∂nnen.</p>
<p>Daf√ºr m√ºssen wir folgende Schritte durchf√ºhren:</p>
<ul>
<li>Einen Android Developer Account registieren</li>
<li>Die Android-App in der Google Play Console erstellen</li>
<li>Die App-Signatur erzeugen</li>
<li>Den App-Signaturschl√ºssel in der PWA hinterlegen</li>
<li>Die TWA mit der <em>Bubblewrap CLI</em> erzeugen</li>
<li>Die signierte App bauen</li>
<li>Die App √ºber die Google Play Console ver√∂ffentlichen</li>
</ul>
<p>Wir wollen als Grundlage f√ºr dieses Beispiel die Angular-Anwendung <em>BookMonkey</em> aus dem Angular-Buch verwenden, die bereits als PWA vorliegt.
M√∂chten Sie die Schritte selbst nachvollziehen, k√∂nnen Sie die Anwendung √ºber GitHub herunterladen:</p>
<p><a href="https://github.com/book-monkey4/book-monkey4-pwa">https://github.com/book-monkey4/book-monkey4-pwa</a></p>
<pre><code>git <span class="hljs-keyword">clone</span> <span class="hljs-title">https</span>://ng-buch.de/bm4-pwa.git
</code></pre>
<p>Die Online-Version der PWA k√∂nnen Sie unter der folgenden URL abrufen:</p>
<p><a href="https://bm4-pwa.angular-buch.com/">https://bm4-pwa.angular-buch.com/</a></p>
<p>Weiterhin ben√∂tigen Sie f√ºr die Erstellung der TWA folgende Voraussetzungen auf dem Entwicklungssystem:</p>
<ul>
<li><a href="https://openjdk.java.net/install/">Java SDK 8.0</a></li>
<li><a href="https://developer.android.com/studio">Android SDK (vorzugsweise Android Studio inkl. SDK)</a></li>
<li><a href="https://nodejs.org">Node.js 10.0 oder h√∂her</a></li>
</ul>
<h3 id="einen-android-developer-account-registrieren">Einen Android Developer Account registrieren</h3>
<blockquote>
<p>Sofern Sie bereits einen Account f√ºr die <em>Google Play Console</em> besitzen, k√∂nnen Sie diesen Schritt √ºberspringen.</p>
</blockquote>
<p>Um eine App im Google Play Store einzustellen, ben√∂tigen wir zun√§chst einen Account f√ºr die <em>Google Play Console</em>.
Den Account k√∂nnen Sie √ºber den folgenden Link registrieren:</p>
<p><a href="https://play.google.com/apps/publish/signup">https://play.google.com/apps/publish/signup</a></p>
<p>Bei der Registrierung wird eine einmalige Registrierungsgeb√ºhr in H√∂he von 25 USD erhoben. Diese Geb√ºhr gilt f√ºr s√§mtliche Apps, die Sie mit dem hinterlegten Google-Account registrieren wollen.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/play-register.png" alt="Google Play Console: Registrierung"></p>
<h3 id="die-android-app-in-der-google-play-console-erstellen">Die Android-App in der Google Play Console erstellen</h3>
<p>Nach der Registierungs m√ºssen wir uns in der <a href="https://play.google.com/apps/publish"><em>Google Play Console</em> einloggen</a>.
Anschlie√üend k√∂nnen wir √ºber den Men√ºpunkt <em>"Alle Apps"</em> mit dem Button <em>"App erstellen"</em> eine neue Anwendung anlegen.
Hier legen wir den Namen der Anwendung, die Standardsprache, den Anwendungstypen (App oder Spiel) sowie den Preis der Anwendung fest.
Weiterhin m√ºssen wir den Programmierrichtlinien f√ºr Entwickler sowie den Exportbestimmungen der USA zustimmen.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/play-create.png" alt="Google Play Console: Eine neue Anwendung erzeugen"></p>
<p>Danach gelangen wir zum Dashboard f√ºr die neue Android-App.
Hier arbeiten wir uns im folgenden durch die Ersteinrichtung der App durch.
Jeder abgeschlossene Punkt wird entsprechend in der Liste markiert.
Alle Einstellungen finden sich auch im Nachhinein links im Men√º wieder und k√∂nnen auch noch sp√§ter angepasst werden.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/play-after-create.png" alt="Google Play Console: Dashboard - Ersteinrichtung"></p>
<ul>
<li><strong>App-Zugriff</strong>: Hier hinterlegen Sie informationen, die darlegen, wie auf die App bei der √úberpr√ºfung vor der Freigabe im Google Play Store zugegriffen werden kann.
Ben√∂tigen die Tester z. B. einen speziellen Account oder Standort oder ist die Anwendung frei zug√§nglich?</li>
<li><strong>Anzeigen</strong>: An dieser Stelle geben Sie an, ob ihre App Werbung enth√§lt oder nicht.</li>
<li><strong>Einstufung des Inhalts</strong>: Sie werden zu einem Fragebogen zur √úberpr√ºfung der Altersfreigaben geleitet, den Sie ausf√ºllen m√ºssen.
Anschlie√üend erhalten Sie eine Bewertung, die Ihnen die Alterseinstufung der Anwendung f√ºr verschiedene L√§nder angibt.</li>
<li><strong>Zielgruppe</strong>: An dieser Stelle geben Sie an, welche Zielgruppe (Altersgruppe) von ihrer Anwendung adressiert wird und ob die Anwendung auch f√ºr Kinder interessant ist.
Je nach Auswahl kann es sein, dass Sie zus√§tzlich eine Datenschutzerkl√§rung hinterlegen m√ºssen.</li>
<li><strong>App-Kategorie ausw√§hlen und Kontaktdaten angeben</strong>: Hier gelangen Sie zu den <em>Play Store Einstellungen</em>.
Sie legen hier die Kategorie der App fest in der sie sp√§ter im Play Store auftauchen soll.
Weiterhin k√∂nnen Sie Tags vergeben und Sie m√ºssen Kontaktdaten f√ºr den Store-Eintrag hinterlegen.</li>
<li><strong>Store-Eintrag einrichten</strong>: Dieser Punkt f√ºhrt Sie zur Hauptkonfiguration des Eintrags f√ºr den Google Play Store.
Sie m√ºssen hier eine kurze sowie eine vollst√§ndige Beschreibung der Anwendung, eine App Icon und Screenshots der Anwendung hinterlegen.</li>
</ul>
<p>Haben wir alle Punkte f√ºr die Ersteinrichtung abgeschlossen, verschwindet der Abschnitt auf unserem Dashboard und wir k√∂nnen uns der Bereitstellung der App widmen.
Daf√ºr ben√∂tigen wir ein Release und eine App-Signatur.</p>
<h3 id="die-app-signatur-und-das-release-erzeugen">Die App-Signatur und das Release erzeugen</h3>
<p>Nach der Ersteinrichtung gilt es unsere App im Play Store bereitzustellen.
Befinden wir uns auf dem Dashboard, so wird uns eine √úbersicht √ºber verschiedene M√∂glichkeiten zur Ver√∂ffentlichung der Anwendung gezeigt.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/play-dashboard-release.png" alt="Google Play Console: Dashboard - App ver√∂ffentlichen"></p>
<p>Diese Wege repr√§sentieren die sogenannten <em>Tracks</em>.
Ein solcher Track kann verschiedene Auspr√§gungen haben:</p>
<ul>
<li><strong>Interner Test</strong>: Releases, die zum Test f√ºr einen bestimmten Personenkreis beispielsweise √ºber einen Link bereitgestellt werden k√∂nnen</li>
<li><strong>Geschlossener Test</strong>: Releases, die nur bestimmten Personen zum Download als Vorab-Release (Alpha Release) zur Verf√ºgung stehen.</li>
<li><strong>Offener Test</strong>: Releases, die f√ºr jeden Nutzer im Google Play Store bereitgestellt werden, aber als Vorab-Release (Beta Release) gekennzeichnet sind. Offene Tracks k√∂nnen auch auf eine bestimmte Anzahl von Nutzer begrenzt werden</li>
<li><strong>Vorregistrierung</strong>: Releases, deren Store-Eintrag bereits vor Ver√∂ffentlichung der Anwendung erstellt werden soll. Nutzer k√∂nnen sich bereits registrieren und erhalten eine Benachrichtigung, sobald die Anwendung verf√ºgbar ist.</li>
<li><strong>Produktion</strong>: Releases, die f√ºr jeden Nutzer im Google Play Store bereitgestellt werden</li>
</ul>
<p>In unserem Szenario wollen wir unsere App direkt bis in den Google Play Store bringen, um zu verifizieren, dass diese auch tats√§chlich von allen Nutzern gefunden und installiert werden kann.
Hierf√ºr nutzen wir den Track f√ºr den offenen Test und erstellen ein Beta-Release.
Daf√ºr klicken wir unter der √úberschrift <em>"Beliebigen Nutzern die Registrierung f√ºr das Testen deiner App bei Google Play erlauben"</em> auf <em>"Aufgaben einblenden"</em>.
Hier klicken wir zun√§chst auf <em>"L√§nder und Regionen ausw√§hlen"</em>.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/play-dashboard-open-track.png" alt="Google Play Console: Dashboard - Einen offenen Track anlegen"></p>
<p>Wir gelangen nun in das Untermen√º zur Erstellung eines offenen Test Tracks und legen die L√§nder fest, in denen unsere Anwendung im Google Play Store verf√ºgbar sein soll.
Anschlie√üend erstellen wir ein neues Release.</p>
<p>Im n√§chsten Schritt ben√∂tigen wir nun die App, die wir unter <em>"App Bundles und APKs"</em> hinterlegen m√ºssen.
Damit diese App jedoch erzeugt und verifiziert werden kann, erzeugen wir zun√§chst unter dem Abschnitt <em>App-Signatur von Google Play</em> √ºber den Button <em>"Weiter"</em> eine neue App Signatur.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/play-beta-sign.png" alt="Google Play Console: Offenes Testrelease erstellen"></p>
<h3 id="den-app-signaturschl√ºssel-in-der-pwa-hinterlegen">Den App-Signaturschl√ºssel in der PWA hinterlegen</h3>
<p>Wir verlassen zun√§chst wieder den Men√ºpunkt zur Erzeugung des Releases und gehen ins Men√º <em>"Einrichten"</em> &gt; <em>"App-Signatur"</em>.
Hier kopieren wir uns den Fingerabdruck des SHA-256-Zertifikats in die Zwischenablage.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/play-signature.png" alt="Google Play Console: Kopieren des App-Signaturschl√ºssels"></p>
<p>Dieser Fingerabdruck stellt sp√§ter sicher, dass beim Aufruf der PWA durch unsere TWA verifiziert werden kann, dass die Anwendung <em>trusted</em> ist, also von Google verifiziert.</p>
<p>Um den Fingerabdruck aufsp√ºren zu k√∂nnen, m√ºssen wir diesen √ºber die spezielle Datei <code>assetlinks.json</code> bereitstellen.
Weiterhin muss die Datei und ihr Inhalt √ºber die spezielle URL <code>https://my-app.com/.well-known/assetlinks.json</code> aufrufbar sein.</p>
<p>Daf√ºr erzeugen wir in unserem Angular-Workspace ein neues Verzeichnis <code>.well-known</code> unter <code>src</code>.
Darin legen wir die Datei <code>assetlinks.json</code> mit dem folgenden Inhalt an:</p>
<pre><code class="language-json">[
  {
    <span class="hljs-attr">"relation"</span>: [<span class="hljs-string">"delegate_permission/common.handle_all_urls"</span>],
    <span class="hljs-attr">"target"</span>: {
      <span class="hljs-attr">"namespace"</span>: <span class="hljs-string">"allfront"</span>,
      <span class="hljs-attr">"package_name"</span>: <span class="hljs-string">"com.angular_buch.book_monkey4"</span>,
      <span class="hljs-attr">"sha256_cert_fingerprints"</span>: [
        <span class="hljs-string">"D1:63:25:CE...A4:FF:79:C0"</span>
      ]
    }
  }
]
</code></pre>
<p>Als <code>package_name</code> legen wir die Anwendungs-ID fest, die im Google Play Store eindeutig sein muss und genau auf eine App zeigt.
Die ID wird in der Regel aus einer Domain gebildet und r√ºckw√§rts gelistet.
Sie muss mindestens einen Punkt enthalten, Zeichen hinter einem Punkt d√ºrfen nur Buchstaben sein, und die gesamte ID darf lediglich Alphanumerische Zeichen enthalten.
Zeichen wie "<code>-</code>" sind nicht erlaubt.
Alle Regeln zur Definition einer validen ID k√∂nnen Sie der <a href="https://developer.android.com/studio/build/application-id">Android Entwicklerdokumentstion</a> entnehmen.</p>
<p>Unter <code>sha256_cert_fingerprints</code> m√ºssen wir au√üerdem den kopierten App-Signaturschl√ºssel eintragen.</p>
<p>Jetzt m√ºssen wir der Angular CLI noch beibringen, dass der URL-Pfad <code>/.well-known/assetlinks.json</code> nicht durch den Angular-Router behandelt und umgeleitet werden soll, sondern dass sich dahinter ein statisches Asset verbrigt, das direkt √ºber die URL aufrufbar sein soll.</p>
<p>Daf√ºr bearbeiten wir die Datei <code>angular.json</code>: Im Abschnitt <code>build</code> &gt; <code>options</code> erg√§nzen wir den Eintrag <code>assets</code>.
Dort geben wir an, dass alle Dateien unter <code>src/.well-known</code> √ºber den relativen Pfad <code>/.well-known/</code> bereitgestellt werden sollen:</p>
<pre><code class="language-json">{
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">"projects"</span>: {
    <span class="hljs-attr">"book-monkey"</span>: {
      <span class="hljs-comment">// ...</span>
      <span class="hljs-attr">"architect"</span>: {
        <span class="hljs-attr">"build"</span>: {
          <span class="hljs-comment">// ...</span>
          <span class="hljs-attr">"options"</span>: {
            <span class="hljs-comment">// ...</span>
            <span class="hljs-attr">"assets"</span>: [
              <span class="hljs-comment">// ...</span>
              {
                <span class="hljs-attr">"glob"</span>: <span class="hljs-string">"**/*"</span>,
                <span class="hljs-attr">"input"</span>: <span class="hljs-string">"src/.well-known/"</span>,
                <span class="hljs-attr">"output"</span>: <span class="hljs-string">"/.well-known/"</span>
              }
              <span class="hljs-comment">// ...</span>
            ],
            <span class="hljs-comment">// ...</span>
          },
          <span class="hljs-comment">// ...</span>
        },
        <span class="hljs-comment">// ...</span>
      },
      <span class="hljs-comment">// ...</span>
    },
    <span class="hljs-comment">// ...</span>
  },
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>Wir √ºberpr√ºfen das Ergebnis am Besten, indem wir einen Produktiiv-Build ausf√ºhren und einen einfachen Webserver starten:</p>
<pre><code class="language-bash">ng build <span class="hljs-params">--prod</span>
<span class="hljs-keyword">cd</span> dist/book-monkey
npx http-server
</code></pre>
<p>Rufen wir nun die URL <code>http://localhost:8080/.well-known/assetlinks.json</code> im Browser auf, sehen wir, dass unsere Datei <code>assetlinks.json</code> dargestellt wird:</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/assetlinks-browser.png" alt="Test der Auslieferung der Datei `assetlinks.json` im Browser"></p>
<p>War der Test erfolgreich, k√∂nnen wir unsere PWA deployen.
Wichtig ist, dass diese zwingend per <code>HTTPS</code> ausgeleifert werden muss.</p>
<blockquote>
<p>Achtung: Nutzen Sie beispielsweise Github Pages zur Auslieferung Ihrer Anwendung, so m√ºssen Sie vor dem Deployment im <code>dist</code>-Verzeichnis (<code>dist/book-monkey</code>) eine Datei <code>_config.yml</code> mit dem Inhalt <code>include: [".well-known"]</code> anlegen, da alle Verzeichnisse beginnend mit "<code>.</code>" per Default <a href="https://github.com/keybase/keybase-issues/issues/366#issuecomment-38749201">von Github Pages ignoriert werden</a>. Diesen Schritt integrieren Sie am besten in Ihre Deployment-Pipeline.</p>
</blockquote>
<p>√úberpr√ºfen Sie nach dem Deployment am Besten noch einmal, ob Sie die URL <code>http://mydomain/.well-known/assetlinks.json</code> aufrufen k√∂nnen.
In unserem Fall w√§re das: <a href="https://bm4-pwa.angular-buch.com/.well-known/assetlinks.json"><code>https://bm4-pwa.angular-buch.com/.well-known/assetlinks.json</code></a>.</p>
<h2 id="die-twa-mit-der-bubblewrap-cli-erzeugen">Die TWA mit der Bubblewrap CLI erzeugen</h2>
<p>Wir haben nun unsere PWA so vorbereitet, dass sie als TWA genutzt werden kann. Alle n√∂tigen Vorbereitungen in der Google Play Console haben wir getroffen.
Als n√§chstes wollen wir die Android-App erstellen, die unsere PWA als TWA aufruft und als eigenst√§ndige App kapselt.</p>
<p>Hierf√ºr nutzen wir die <a href="https://www.npmjs.com/package/@bubblewrap/cli"><em>Bubblewrap CLI</em></a>:
Wir k√∂nnen das Tool direkt als NPM-Paket √ºber <code>npx</code> aufrufen und so die App erzeugen lassen.
Der interaktive Wizard f√ºhrt uns durch das Setup:</p>
<pre><code class="language-bash">mkdir monkey4-pwa-twa-<span class="hljs-keyword">wrapper</span>
cd monkey4-pwa-twa-<span class="hljs-keyword">wrapper</span>
npx @bubblewrap/cli init <span class="hljs-comment">--manifest https://bm4-pwa.angular-buch.com/manifest.json</span>
</code></pre>
<p>Nutzen wir die Bubblewrap CLI zum ersten Mal, so werden wir in den ersten zwei Schritten nach den Verzeichnissen f√ºr das <a href="https://openjdk.java.net/">Java OpenJDK</a> und das <a href="https://developer.android.com/studio">AndroidSDK</a> gefragt.
Hier geben wir die Pfade zu den entsprechenden Verzeichnissen an.
Unter macOS lauten sie zum Beispiel:</p>
<pre><code class="language-bash">? Path to the JDK: <span class="hljs-regexp">/Library/</span>Java<span class="hljs-regexp">/JavaVirtualMachines/</span>adoptopenjdk-<span class="hljs-number">8</span>.jdk
? Path to the Android SDK: <span class="hljs-regexp">/Users/my</span>-user<span class="hljs-regexp">/Library/</span>Android/sdk
</code></pre>
<blockquote>
<p>Diese Angaben werden f√ºr sp√§tere Installationen in der Datei <code>~/.llama-pack/llama-pack-config.json</code> gespeichert und k√∂nnen bei Bedarf angepasst werden.</p>
</blockquote>
<p>Im n√§chsten Schritt liest die Bubblewrap CLI das Web App Manifest unserer PWA aus und stellt einige Fragen zu den Metadaten der App: Bezeichnung, hinterlegte Icons und Pfade.
Diese Einstellungen werden in der Regel schon korrekt ausgelesen und m√ºssen nicht manuell angepasst werden:</p>
<pre><code class="language-bash">init Fetching Manifest:  <span class="hljs-keyword">https</span>://bm4-pwa.angular-buch.com/manifest.json
? Domain being opened <span class="hljs-keyword">in</span> <span class="hljs-keyword">the</span> TWA: bm4-pwa.angular-buch.com
? Name <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> application: BookMonkey <span class="hljs-number">4</span> PWA
? Name <span class="hljs-built_in">to</span> be shown <span class="hljs-keyword">on</span> <span class="hljs-title">the</span> <span class="hljs-title">Android</span> <span class="hljs-title">Launcher</span>: <span class="hljs-title">BookMonkey</span>
? Color <span class="hljs-built_in">to</span> be used <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> status bar: <span class="hljs-comment">#DB2828</span>
? Color <span class="hljs-built_in">to</span> be used <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> splash screen background: <span class="hljs-comment">#FAFAFA</span>
? Relative path <span class="hljs-built_in">to</span> <span class="hljs-built_in">open</span> <span class="hljs-keyword">the</span> TWA: /
? <span class="hljs-built_in">URL</span> <span class="hljs-built_in">to</span> <span class="hljs-keyword">an</span> image that is <span class="hljs-keyword">at</span> least <span class="hljs-number">512</span>x512px: <span class="hljs-keyword">https</span>://bm4-pwa.angular-buch.com/assets/icons/icon<span class="hljs-number">-512</span>x512.png
? <span class="hljs-built_in">URL</span> <span class="hljs-built_in">to</span> <span class="hljs-keyword">an</span> image that is <span class="hljs-keyword">at</span> least <span class="hljs-number">512</span>x512px <span class="hljs-built_in">to</span> be used when generating maskable icons undefined
? Include app shortcuts?
  Yes
? Android Package Name (<span class="hljs-keyword">or</span> Application ID): com.angular_buch.bm4_pwa.twa
</code></pre>
<p>In der n√§chsten Abfrage m√ºssen wir den Schl√ºssel zur Signierung der App angeben.
Haben wir hier noch keinen Schl√ºssel erzeugt, werden wir darauf hingewiesen und k√∂nnen einen neuen Schl√ºssel anlegen.
Daf√ºr m√ºssen wir einige Infos zum Ersteller des Schl√ºssels hinterlegen.
Au√üerdem m√ºssen wir ein Passwort f√ºr den <em>Key Store</em> und eines f√ºr den einzelnen <em>Key</em> der Anwendung angeben.
Dieses ben√∂tigen wir sp√§ter beim Build und beim Signieren der App erneut.</p>
<pre><code class="language-bash">? Location <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> Signing Key: ./android.keystore
? Key name: android
...
? Signing Key could <span class="hljs-keyword">not</span> be found <span class="hljs-keyword">at</span> <span class="hljs-string">"./android.keystore"</span>. Do you want <span class="hljs-built_in">to</span> <span class="hljs-built_in">create</span> <span class="hljs-literal">one</span> now? Yes
? First <span class="hljs-keyword">and</span> Last names (eg: John Doe): John Doe
? Organizational Unit (eg: Engineering Dept): Engineering Dept
? Organization (eg: Company Name): My Company
? Country (<span class="hljs-number">2</span> letter code): DE
? Password <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> Key Store: [hidden]
? Password <span class="hljs-keyword">for</span> <span class="hljs-keyword">the</span> Key: [hidden]
keytool Signing Key created successfully
init
init Project generated successfully. Build <span class="hljs-keyword">it</span> <span class="hljs-keyword">by</span> running <span class="hljs-string">"@bubblewrap/cli build"</span>
</code></pre>
<p>Im Ergebnis sollten wir folgende Dateistruktur erhalten:</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/twa-bubblewrap.png" alt="Dateistruktur nach Erzeugung der TWA mithilfe der Bubblewrap CLI"></p>
<p>Prinzipiell sind wir damit auch schon fertig.
Wir m√ºssen nun noch die fertige Android-App (<code>*.apk</code>-Datei) erzeugen.</p>
<p>Das Ergebnis der TWA-Generierung k√∂nnen Sie auch in folgendem Repository nachvollziehen:</p>
<p><a href="https://github.com/book-monkey4/book-monkey4-pwa-twa-wrapper">https://github.com/book-monkey4/book-monkey4-pwa-twa-wrapper</a></p>
<h2 id="die-signierte-app-bauen">Die signierte App bauen</h2>
<p>Wir k√∂nnen unsere signierte Android-App entwerder direkt mithilfe der Bubblewrap CLI bauen, oder wir nutzen hierf√ºr Android Studio.</p>
<h3 id="mit-der-bublewrap-cli">Mit der Bublewrap CLI</h3>
<p>Wir rufen das <code>build</code>-Kommando der Bubblewrap CLI auf.
Hier m√ºssen wir zun√§chst das von uns vergebene Passwort f√ºr den Key Store und anschlie√üend das Passwort f√ºr den konkreten Key eingeben:</p>
<pre><code class="language-bash">npx @bubblewrap/cli build
? KeyStore password: ********
? Key password: ********
build Building the Android<span class="hljs-params">-App...</span>
build Zip Aligning<span class="hljs-params">...</span>
build Checking PWA Quality Criteria<span class="hljs-params">...</span>
build
build Check the <span class="hljs-literal">full</span> PageSpeed Insights report at:
build - https:<span class="hljs-comment">//developers.google.com/speed/pagespeed/insights/?url=https%3A%2F%2Fbm4-pwa.angular-buch.com%2F</span>
build
build
build Quality Criteria scores
build Lighthouse Performance score: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>. <span class="hljs-number">80</span>
build Lighthouse PWA check: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span> NO
build
build Web Vitals
build Largest Contentful Paint (LCP) <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span> <span class="hljs-number">3.7</span> s
build Maximum Potential First Input Delay (<span class="hljs-keyword">Max</span> FID) <span class="hljs-params">...</span> <span class="hljs-number">391</span> ms
build Cumulative Layout Shift (CLS) <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>. <span class="hljs-number">0.00</span>
build
build Other scores
build Lighthouse Accessibility score<span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span>. <span class="hljs-number">67</span>
build
build Summary
build Overall result: <span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span><span class="hljs-params">...</span> <span class="hljs-keyword">FAIL</span>
build WARNING PWA Quality Criteria check failed.
build Signing<span class="hljs-params">...</span>
build Signed Android<span class="hljs-params">-App</span> generated at <span class="hljs-string">"./app-release-signed.apk"</span>
build Digital Asset Links file generated at ./assetlinks.json
build Read more about setting up Digital Asset Links at https:<span class="hljs-comment">//developers.google.com/web/android/trusted-web-activity/quick-start#creating-your-asset-link-file</span>
</code></pre>
<p>Wenn wir keinen Fehler erhalten, sollte sich die fertige signierte App im Hauptverzeichnis befinden und <code>app-release-signed.apk</code> hei√üen.</p>
<p>Vereinzelt kann es dazu kommen, dass wir eine Fehlermeldung wie die folgende erhalten:</p>
<pre><code>UnhandledPromiseRejectionWarning: Error: <span class="hljs-builtin-name">Error</span> calling the PageSpeed Insights API: Error: Failed <span class="hljs-keyword">to</span> <span class="hljs-builtin-name">run</span> the PageSpeed Insight report
</code></pre>
<p>In diesem Fall schl√§gt die Analyse der App fehl, weil beispielsweise die Website gerade nicht erreichbar ist. Wir k√∂nnen den Build erneut aufrufen und das Flag <code>--skipPwaValidation</code> verwenden, um die √úberpr√ºfung der PWA zu √ºberspringen.</p>
<pre><code class="language-bash">npx @bubblewrap/cli <span class="hljs-keyword">build</span> --skipPwaValidation
? KeyStore <span class="hljs-keyword">password</span>: ********
? <span class="hljs-keyword">Key</span> <span class="hljs-keyword">password</span>: ********
<span class="hljs-keyword">build</span> Building the Android-App...
<span class="hljs-keyword">build</span> Zip Aligning...
<span class="hljs-keyword">build</span> Signing...
<span class="hljs-keyword">build</span> Signed Android-App generated at <span class="hljs-string">"./app-release-signed.apk"</span>
<span class="hljs-keyword">build</span> Digital Asset Links file generated at ./assetlinks.json
<span class="hljs-keyword">build</span> Read more about setting up Digital Asset Links at https://developers.google.com/web/android/trusted-web-activity/quick-<span class="hljs-keyword">start</span>#creating-your-asset-link-file
</code></pre>
<p>Kommt es zu dem nachfolgenden Fehler, pr√ºfen Sie bitte den Pfad unter <code>jdkPath</code> in der Datei <code>~/.llama-pack/llama-pack-config.json</code>.
Dieser sollte auf das lokale Hauptverzeichnis des Java JDK 8 zeigen.
Alternativ k√∂nnen Sie den Build mithilfe von Android Studio ansto√üen.</p>
<pre><code class="language-bash">cli ERROR Command failed: <span class="hljs-string">./gradlew</span> assembleRelease <span class="hljs-params">--stacktrace</span>
</code></pre>
<h3 id="mithilfe-von-android-studio">Mithilfe von Android Studio</h3>
<p>Bei dieser Variante √∂ffnen wir zun√§chst das Projektverzeichnis in Android Studio.
Nun warten wir ab, bis der automatische Gradle-Build nach dem √ñffnen des Projekts durchgelaufen ist.
Den Fortschritt k√∂nnen wir unten rechts in Android Studio betrachten.
Anschlie√üend klicken w√ºr im Men√º <em>"Build"</em> auf <em>"Generate Signed Bundle / APK"</em>.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/android-studio-generate-signed-apk.png" alt="Android Studio: Signierte APK erstellen"></p>
<p>Wir w√§hlen hier den Punkt <em>"APK"</em> aus und klicken auf <em>"Next"</em>.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/android-studio-generate-signed-apk2.png" alt="Android Studio: Signierte APK erstellen"></p>
<p>Im n√§chsten Schritt w√§hlen wir den erstellten Keystore (<code>android.keystore</code>) aus dem Projektverzeichnis aus und geben das festgelegte Passwort ein.
Alternativ k√∂nnen wir auch einen neuen Keystore erstellen.
Anschlie√üend k√∂nnen wir aus dem Keystore den <em>"Key alias"</em> ausw√§hlen (<code>android</code>).
Auch hier m√ºssen wir das Passwort eingeben, das wir zuvor f√ºr den konkreten Key vergeben haben.
Haben wir alle Angaben korrekt get√§tigt, gehen wir weiter mit <em>"Next"</em>.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/android-studio-generate-signed-apk3.png" alt="Android Studio: Signierte APK erstellen"></p>
<p>Im n√§chsten Schritt w√§hlen wir als Build-Variante <em>release</em> aus und setzen die beiden Checkboxen bei <em>"V1 (Jar Signature)"</em> und <em>"V2 (Full APK Signature)"</em>.
Anschlie√üend k√∂nnen wir die Erzeugung mit <em>"Finish"</em> starten.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/android-studio-generate-signed-apk3.png" alt="Android Studio: Signierte APK erstellen"></p>
<p>Die erzeugte APK befindet sich nun unter <code>./app/release/app-release.apk</code>.</p>
<blockquote>
<p>Kommt es beim Erzeugen der signierten APK zu einem Fehler, kann dies ggf. an einem defekten/falschen Keystore liegen. Versuchen Sie in diesem Fall, einen neuen Keystore w√§hrend der vorherigen Schritte zu erzeugen.</p>
</blockquote>
<h2 id="die-app-√ºber-die-google-play-console-ver√∂ffentlichen">Die App √ºber die Google Play Console ver√∂ffentlichen</h2>
<p>Im letzten Schritt m√ºssen wir unsere signierte und erzeugte Android-App noch bereitstellen und ver√∂ffentlichen.
Dazu gehen wir in der Google Play Console in das Men√º <em>"Test"</em> &gt; <em>"Offene Tests"</em> und √∂ffnen unser zuvor bereits vorbereitetes Release im Abschnitt <em>"Releases</em>", welches im Status <em>"Entwurf"</em> ist durch Klick auf den Button <em>"Bearbeiten"</em>.</p>
<p>Im n√§chsten Schritt k√∂nnen wir nun die zuvor erzeugte APK-Datei hochladen.
Weiterhin geben wir eine Versionsnummer und eine Beschreibung zum Release an.
Haben wir alles ausgef√ºllt, klicken wir auf <em>"√úberpr√ºfen"</em>.</p>
<!-- TODO: @JohannesHoppe ab hier weiter :) (Text und Screenshots anpassen) -->

<p>Jetzt haben wir es fast geschafft:
Das Beta-Release wurde erstellt.
Auf der n√§chsten Seite k√∂nnen wir die App nun ver√∂ffentlichen.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/play-beta-release.png" alt="Google Play Console: Das Beta-Release ver√∂ffentlichen"></p>
<p>Haben wir diesen Schritt erledigt, √§ndert sich unser Men√º auf der linken Seite ein wenig, und wir k√∂nnen unter <em>"√úbersicht"</em> den aktuellen Status zur Ver√∂ffentlichung der Android-App einsehen.
Bis die App tats√§chlich ver√∂ffentlicht und freigegeben wird, k√∂nnen ggf. ein paar Tage vergehen.</p>
<p><img src="https://website-articles.angular-buch.com/blog/2020-11-twa/play-release-overview.png" alt="Google Play Console: √úbersicht mit Ver√∂ffentlichungsstatus"></p>
<p>Geschafft! Wir haben nun erfolgreich unsere Angular-PWA in eine Android-App integriert und sie im Google Play Store ver√∂ffentlicht.
Dabei haben wir das Konzept der Trusted Web Activity (TWA) genutzt.
Nun m√ºssen wir nur noch auf die Freigabe warten, und wir k√∂nnen unsere App im Store finden und installieren.</p>
<!-- TODO: @JohannesHoppe Bild von ver√∂ffentlichter App in Play Store -->

<p><strong>Viel Spa√ü w√ºnschen
Johannes, Danny und Ferdinand</strong></p>
</p><!----><!----><a routerlink="/blog" ripple-radius="" class="btn btn-sm btn-primary mt-4" href="/blog"><i class="fa fa-backward mr-2"></i> Zur√ºck</a><hr> Suggestions? Feedback? Bugs? Please <a target="_blank" class="content" href="https://github.com/angular-buch/website-articles/blob/gh-pages/blog/2020-11-twa/README.md"><i class="fa fa-github mr-1" style="font-size: 1.6rem; position: relative; bottom: -3px;"></i>fork/edit this page on Github</a>. </div></div></div></div></div><!----></div><!----></div></section><app-json-ld><script type="application/ld+json">{
  "url": "https://angular.schule/blog/2020-11-twa",
  "headline": "Trusted Web Activitys (TWA) mit Angular",
  "description": "Progressive Web Apps sind in den letzten Jahren immer popul√§rer geworden.\nSie erlauben es uns, Webanwendungen auf dem Home-Bildschirm des Smartphones zu installieren und wie eine nativ installierte App zu benutzen.\nMit einer PWA k√∂nnen wir Daten mithilfe eines Service Workers cachen, um die Anwendung auch offline zu verwenden.\nWeiterhin kann eine PWA im Hintergrund Push-Benachrichtigungen vom Server empfangen und anzeigen.",
  "datePublished": "2020-11-17",
  "dateModified": "2020-11-17",
  "publisher": {
    "name": "Angular-Buch",
    "url": "https://angular-buch.com",
    "@type": "Organization",
    "logo": {
      "@type": "ImageObject",
      "url": "https://angular-buch.com/assets/img/brand_export.png"
    }
  },
  "image": "https://website-articles.angular-buch.com/blog/2020-11-twa/header-twa.jpg",
  "thumbnailUrl": "https://website-articles.angular-buch.com/blog/2020-11-twa/header-twa.jpg",
  "author": {
    "@type": "Person",
    "name": "Danny Koppenhagen",
    "email": "mail@d-koppenhagen.de"
  },
  "keywords": [
    "TWA",
    "Trusted Web Activity",
    "PWA",
    "Progressive Web App",
    "Angular",
    "Android",
    "Android Store"
  ],
  "mainEntityOfPage": "http://schema.org/WebPage",
  "@type": "Article",
  "@context": "http://schema.org"
}</script></app-json-ld></app-blog-details><!----><footer><div class="container"><div class="row align-items-center"><div class="col-sm-9"><div class="links"><app-link><!----><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/"><!----> Home </a><!----><!----><!----></app-link>|<!----><!----><!----><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/impressum"><!----> Impressum </a><!----><!----><!----><!----></app-link>|<!----><!----><!----><app-link><!----><!----><a routerlinkactive="nav__current" ariacurrentwhenactive="page" class="links__item" href="/datenschutz"><!----> Datenschutzerkl√§rung </a><!----><!----><!----><!----></app-link>|<!----><!----><!----><app-link><!----><a class="links__item links__twitter" href="https://twitter.com/angular_buch" rel="nofollow"><!----> Twitter </a><!----><!----><!----><!----><!----></app-link><!----><!----><!----></div></div><div class="col-sm-3 text-right"></div></div></div></footer></main><app-json-ld><script type="application/ld+json"></script></app-json-ld></app-root>
<script src="polyfills-LZBJRJJE.js" type="module"></script><script src="main-YI7NJDHW.js" type="module"></script>

</body></html>